<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CircleFi â€” Interactive Demo</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body, #root { height: 100%; width: 100%; overflow: hidden; }
  body { 
    font-family: 'Plus Jakarta Sans', -apple-system, sans-serif; 
    background: #0A0E17;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  @media (min-width: 481px) {
    #root {
      width: 390px;
      max-height: 844px;
      border-radius: 40px;
      overflow: hidden;
      box-shadow: 0 20px 80px rgba(0,0,0,.6), 0 0 0 3px rgba(255,255,255,.08);
      position: relative;
    }
    #root::before {
      content: '';
      position: absolute;
      top: 0; left: 50%;
      transform: translateX(-50%);
      width: 120px; height: 28px;
      background: #000;
      border-radius: 0 0 16px 16px;
      z-index: 9999;
    }
  }
  @media (max-width: 480px) {
    #root { width: 100%; height: 100%; border-radius: 0; }
  }
  .back-link {
    position: fixed; top: 16px; left: 16px; z-index: 10000;
    padding: 8px 16px; border-radius: 10px;
    background: rgba(0,0,0,.6); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,.1);
    color: rgba(255,255,255,.6); font-size: 12px; font-weight: 600;
    text-decoration: none; font-family: 'Plus Jakarta Sans', sans-serif;
    transition: .2s;
  }
  .back-link:hover { color: #00D65B; border-color: rgba(0,214,91,.3); }
  @media (max-width: 480px) { .back-link { top: 8px; left: 8px; font-size: 11px; padding: 6px 12px; } }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
<a href="index.html" class="back-link">â† Back to CircleFi</a>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

// â”€â”€â”€ Brand Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Replace these with your actual brand assets
const APP_NAME = "CircleFi";
const APP_TAGLINE = "Your Circle. Your Finance.";
const BRAND = {
  primary: "#00B14F",
  primaryLight: "#00D65B",
  accent: "#A855F7",
  dark: "#0A0E17",
  cardBg: "#111827",
};

// â”€â”€â”€ Logo Component (SVG Placeholder) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Replace the SVG contents with your actual logo
function Logo({ size = 32, variant = "icon", color = "#fff" }) {
  // Icon-only variant (for nav bars, small spaces)
  if (variant === "icon") {
    return (
      <div
        style={{
          width: size,
          height: size,
          position: "relative",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
        }}
        title="Replace with your logo"
      >
        <svg width={size} height={size} viewBox="0 0 40 40" fill="none">
          {/* Outer ring â€” represents community/circle */}
          <circle cx="20" cy="20" r="18" stroke={BRAND.primary} strokeWidth="2.5" opacity="0.3" />
          <circle cx="20" cy="20" r="18" stroke={BRAND.primary} strokeWidth="2.5"
            strokeDasharray="113.1" strokeDashoffset="28.3" strokeLinecap="round" />
          {/* Inner rotating arrows â€” represents rotation/savings cycle */}
          <path d="M20 10 L20 14 M20 26 L20 30" stroke={BRAND.primaryLight} strokeWidth="2" strokeLinecap="round" />
          <path d="M10 20 L14 20 M26 20 L30 20" stroke={BRAND.primaryLight} strokeWidth="2" strokeLinecap="round" />
          {/* Center coin/peso symbol */}
          <circle cx="20" cy="20" r="7" fill={BRAND.primary} />
          <text x="20" y="24" textAnchor="middle" fill="#fff" fontSize="11" fontWeight="bold" fontFamily="sans-serif">â‚±</text>
        </svg>
      </div>
    );
  }

  // Full logo with wordmark (for headers, splash)
  if (variant === "full") {
    return (
      <div
        style={{
          display: "flex",
          alignItems: "center",
          gap: 10,
        }}
        title="Replace with your logo"
      >
        <svg width={size} height={size} viewBox="0 0 40 40" fill="none">
          <circle cx="20" cy="20" r="18" stroke={BRAND.primary} strokeWidth="2.5" opacity="0.3" />
          <circle cx="20" cy="20" r="18" stroke={BRAND.primary} strokeWidth="2.5"
            strokeDasharray="113.1" strokeDashoffset="28.3" strokeLinecap="round" />
          <path d="M20 10 L20 14 M20 26 L20 30" stroke={BRAND.primaryLight} strokeWidth="2" strokeLinecap="round" />
          <path d="M10 20 L14 20 M26 20 L30 20" stroke={BRAND.primaryLight} strokeWidth="2" strokeLinecap="round" />
          <circle cx="20" cy="20" r="7" fill={BRAND.primary} />
          <text x="20" y="24" textAnchor="middle" fill="#fff" fontSize="11" fontWeight="bold" fontFamily="sans-serif">â‚±</text>
        </svg>
        <div>
          <div style={{
            fontSize: size * 0.52,
            fontWeight: 800,
            color: color,
            letterSpacing: -0.5,
            lineHeight: 1.1,
          }}>
            {APP_NAME}
          </div>
          <div style={{
            fontSize: size * 0.22,
            color: "rgba(255,255,255,0.4)",
            fontWeight: 500,
            letterSpacing: 0.3,
          }}>
            {APP_TAGLINE}
          </div>
        </div>
      </div>
    );
  }

  // Wordmark only (no icon)
  if (variant === "wordmark") {
    return (
      <span
        style={{
          fontSize: size * 0.5,
          fontWeight: 800,
          color: color,
          letterSpacing: -0.5,
        }}
        title="Replace with your logo"
      >
        {APP_NAME}
      </span>
    );
  }

  return null;
}

// â”€â”€â”€ Logo Placeholder Box (for image-based logos) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Use this if you want to drop in a PNG/SVG file instead
function LogoImagePlaceholder({ width = 120, height = 40, label = "Your Logo Here" }) {
  return (
    <div
      style={{
        width,
        height,
        borderRadius: 8,
        border: "2px dashed rgba(0,177,79,0.3)",
        background: "rgba(0,177,79,0.05)",
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        gap: 6,
        cursor: "pointer",
      }}
      title="Replace with <img src='your-logo.png' />"
    >
      <span style={{ fontSize: 14 }}>ğŸ–¼</span>
      <span style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 600 }}>
        {label}
      </span>
    </div>
  );
}

// â”€â”€â”€ Constants & Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const REGIONS = {
  PH: {
    currency: "PHP",
    symbol: "â‚±",
    flag: "ğŸ‡µğŸ‡­",
    name: "Philippines",
    methods: [
      { id: "gcash", name: "GCash", icon: "ğŸ’š", color: "#00B14F" },
      { id: "maya", name: "Maya", icon: "ğŸ’œ", color: "#6C3FBF" },
      { id: "bank", name: "Bank Transfer", icon: "ğŸ¦", color: "#1A2B4A" },
    ],
    rate: 56.2, // reference rate
  },
  US: {
    currency: "USD",
    symbol: "$",
    flag: "ğŸ‡ºğŸ‡¸",
    name: "United States",
    methods: [
      { id: "card", name: "Credit Card", icon: "ğŸ’³", color: "#1A2B4A" },
      { id: "bank", name: "Bank Transfer", icon: "ğŸ¦", color: "#2D5A27" },
    ],
    rate: 1,
  },
  GLOBAL: {
    currency: "USD",
    symbol: "$",
    flag: "ğŸŒ",
    name: "Global",
    methods: [
      { id: "card", name: "Credit Card", icon: "ğŸ’³", color: "#1A2B4A" },
      { id: "bank", name: "Wire Transfer", icon: "ğŸ¦", color: "#2D5A27" },
    ],
    rate: 1,
  },
};

const MOCK_USER = {
  id: "usr_7x8k2m",
  name: "Maria Santos",
  region: "PH",
  walletAddress: "0x7a3B...9f2E" // blockchain audit address,
  walletBalance: 89.42, // USDC
  avatar: "MS",
};

const MOCK_POOL = {
  id: "pool_abc123",
  name: "Bahay Fund",
  members: 10,
  monthlyContribution: 1000, // in local fiat
  totalPot: 56200, // PHP
  currentRound: 3,
  totalRounds: 10,
  nextPayout: "2026-03-01",
  status: "active",
};

// â”€â”€â”€ Supabase Schema (displayed as reference) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUPABASE_SCHEMA = {
  users: `
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  full_name TEXT,
  phone TEXT,
  region TEXT DEFAULT 'PH',
  currency_preference TEXT DEFAULT 'PHP',
  wallet_address TEXT,
  wallet_encrypted_key TEXT,
  kyc_status TEXT DEFAULT 'pending',
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);`,
  transactions: `
CREATE TABLE transactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id),
  pool_id UUID REFERENCES pools(id),
  type TEXT CHECK (type IN ('deposit','withdrawal','payout','bid_fee')),
  fiat_amount DECIMAL(12,2),
  fiat_currency TEXT DEFAULT 'PHP',
  usdc_amount DECIMAL(12,6),
  exchange_rate DECIMAL(12,6),
  payment_method TEXT,
  payment_reference TEXT,
  receipt_url TEXT,
  status TEXT DEFAULT 'pending' 
    CHECK (status IN ('pending','verifying','confirmed','failed','refunded')),
  verified_by UUID REFERENCES users(id),
  verified_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now()
);`,
  pools: `
CREATE TABLE pools (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  manager_id UUID REFERENCES users(id),
  contribution_amount DECIMAL(12,2),
  contribution_currency TEXT DEFAULT 'PHP',
  max_members INT DEFAULT 10,
  current_round INT DEFAULT 1,
  total_rounds INT,
  status TEXT DEFAULT 'forming',
  smart_contract_address TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);`,
  bids: `
CREATE TABLE bids (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  pool_id UUID REFERENCES pools(id),
  user_id UUID REFERENCES users(id),
  round_number INT NOT NULL,
  bid_amount_fiat DECIMAL(12,2),
  bid_amount_usdc DECIMAL(12,6),
  currency TEXT DEFAULT 'PHP',
  status TEXT DEFAULT 'active',
  is_winner BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT now()
);`,
};

// â”€â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const formatCurrency = (amount, symbol = "â‚±") =>
  `${symbol}${Number(amount).toLocaleString("en", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

const formatUSDC = (amount) =>
  `${Number(amount).toFixed(2)} USDC`;

const fiatToUSDC = (amount, rate) => (amount / rate).toFixed(6);

const timeAgo = (ms) => {
  const s = Math.floor(ms / 1000);
  if (s < 60) return `${s}s ago`;
  if (s < 3600) return `${Math.floor(s / 60)}m ago`;
  return `${Math.floor(s / 3600)}h ago`;
};

// â”€â”€â”€ Animated Number â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AnimatedNumber({ value, prefix = "", suffix = "" }) {
  const [display, setDisplay] = useState(value);
  const ref = useRef(null);

  useEffect(() => {
    const start = display;
    const end = value;
    const duration = 600;
    const startTime = Date.now();
    const tick = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      setDisplay(start + (end - start) * eased);
      if (progress < 1) ref.current = requestAnimationFrame(tick);
    };
    ref.current = requestAnimationFrame(tick);
    return () => cancelAnimationFrame(ref.current);
  }, [value]);

  return (
    <span>
      {prefix}
      {Number(display).toLocaleString("en", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
      {suffix}
    </span>
  );
}

// â”€â”€â”€ Toast Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Toast({ message, type = "success", onClose }) {
  useEffect(() => {
    const timer = setTimeout(onClose, 3500);
    return () => clearTimeout(timer);
  }, [onClose]);

  const bg = type === "success" ? "#00B14F" : type === "error" ? "#EF4444" : "#F59E0B";
  const icon = type === "success" ? "âœ“" : type === "error" ? "âœ•" : "!";

  return (
    <div
      style={{
        position: "fixed",
        top: 20,
        left: "50%",
        transform: "translateX(-50%)",
        background: bg,
        color: "#fff",
        padding: "12px 24px",
        borderRadius: 12,
        fontSize: 14,
        fontWeight: 600,
        zIndex: 9999,
        display: "flex",
        alignItems: "center",
        gap: 8,
        boxShadow: `0 8px 32px ${bg}44`,
        animation: "slideDown 0.3s ease-out",
      }}
    >
      <span
        style={{
          width: 22,
          height: 22,
          borderRadius: "50%",
          background: "rgba(255,255,255,0.3)",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          fontSize: 12,
        }}
      >
        {icon}
      </span>
      {message}
    </div>
  );
}

// â”€â”€â”€ Bottom Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BottomNav({ active, onNavigate }) {
  const items = [
    { id: "home", label: "Home", icon: "âŒ‚" },
    { id: "circles", label: "Circles", icon: "â—" },
    { id: "bid", label: "Bid", icon: "âš¡" },
    { id: "settings", label: "More", icon: "â‹¯" },
  ];

  return (
    <div
      style={{
        display: "flex",
        justifyContent: "space-around",
        alignItems: "center",
        padding: "8px 0 20px",
        background: "#0A0E17",
        borderTop: "1px solid rgba(255,255,255,0.06)",
        position: "sticky",
        bottom: 0,
      }}
    >
      {items.map((item) => {
        const isActive = active === item.id;
        return (
          <button
            key={item.id}
            onClick={() => onNavigate(item.id)}
            style={{
              background: "none",
              border: "none",
              color: isActive ? "#00B14F" : "rgba(255,255,255,0.35)",
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              gap: 2,
              cursor: "pointer",
              padding: "4px 16px",
              borderRadius: 8,
              transition: "all 0.2s",
              transform: isActive ? "scale(1.05)" : "scale(1)",
            }}
          >
            <span style={{ fontSize: 20, lineHeight: 1 }}>
              {item.icon}
            </span>
            <span style={{ fontSize: 10, fontWeight: isActive ? 700 : 500 }}>
              {item.label}
            </span>
          </button>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ Home Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function HomeScreen({ user, region, onNavigate }) {
  const r = REGIONS[region];
  const fiatBalance = user.walletBalance * r.rate;

  return (
    <div style={{ padding: "0 20px 20px" }}>
      {/* App Logo Bar */}
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "12px 0 4px" }}>
        <Logo size={28} variant="full" />
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <button style={{ background: "rgba(255,255,255,0.06)", border: "none", borderRadius: 10, padding: "8px 10px", cursor: "pointer", color: "rgba(255,255,255,0.5)", fontSize: 16 }}>
            ğŸ””
          </button>
        </div>
      </div>

      {/* Greeting Header */}
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          padding: "12px 0 16px",
        }}
      >
        <div>
          <div style={{ fontSize: 13, color: "rgba(255,255,255,0.5)", fontWeight: 500 }}>
            Good evening,
          </div>
          <div style={{ fontSize: 20, fontWeight: 700, color: "#fff" }}>
            {user.name}
          </div>
        </div>
        <div
          style={{
            width: 42,
            height: 42,
            borderRadius: "50%",
            background: "linear-gradient(135deg, #00B14F, #00D65B)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            fontSize: 14,
            fontWeight: 700,
            color: "#fff",
          }}
        >
          {user.avatar}
        </div>
      </div>

      {/* Balance Card */}
      <div
        style={{
          background: "linear-gradient(145deg, #111827, #1A2332)",
          borderRadius: 20,
          padding: "28px 24px",
          border: "1px solid rgba(255,255,255,0.06)",
          marginBottom: 24,
          position: "relative",
          overflow: "hidden",
        }}
      >
        <div
          style={{
            position: "absolute",
            top: -40,
            right: -40,
            width: 120,
            height: 120,
            borderRadius: "50%",
            background: "radial-gradient(circle, rgba(0,177,79,0.15), transparent)",
          }}
        />
        <div style={{ fontSize: 12, color: "rgba(255,255,255,0.45)", fontWeight: 600, letterSpacing: 1, textTransform: "uppercase", marginBottom: 8 }}>
          Total Balance
        </div>
        <div style={{ fontSize: 36, fontWeight: 800, color: "#fff", marginBottom: 4, fontFamily: "'SF Pro Display', -apple-system, sans-serif" }}>
          <AnimatedNumber value={fiatBalance} prefix={r.symbol} />
        </div>
        <div style={{ fontSize: 13, color: "rgba(255,255,255,0.4)", fontWeight: 500 }}>
          ğŸ”— Blockchain verified
        </div>

        {/* Quick Actions */}
        <div style={{ display: "flex", gap: 10, marginTop: 24 }}>
          {[
            { label: "Cash In", icon: "â†“", action: "deposit", primary: true },
            { label: "Cash Out", icon: "â†‘", action: "withdraw" },
            { label: "Send", icon: "â†’", action: "send" },
          ].map((btn) => (
            <button
              key={btn.label}
              onClick={() => btn.action === "deposit" && onNavigate("deposit")}
              style={{
                flex: 1,
                padding: "12px 0",
                borderRadius: 12,
                border: btn.primary ? "none" : "1px solid rgba(255,255,255,0.1)",
                background: btn.primary
                  ? "linear-gradient(135deg, #00B14F, #00D65B)"
                  : "rgba(255,255,255,0.04)",
                color: "#fff",
                fontSize: 13,
                fontWeight: 600,
                cursor: "pointer",
                display: "flex",
                flexDirection: "column",
                alignItems: "center",
                gap: 4,
                transition: "all 0.2s",
              }}
            >
              <span style={{ fontSize: 18 }}>{btn.icon}</span>
              {btn.label}
            </button>
          ))}
        </div>
      </div>

      {/* â”€â”€â”€ My Active Circles â”€â”€â”€ */}
      <div style={{ marginBottom: 20 }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 }}>
          <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>My Circles</div>
          <button onClick={() => onNavigate("circles")} style={{ background: "none", border: "none", color: "#00D65B", fontSize: 11, fontWeight: 700, cursor: "pointer" }}>
            View All â†’
          </button>
        </div>

        {/* Circle Cards â€” all circles user is in */}
        {[
          {
            ...MOCK_POOL, emoji: "ğŸ ", role: "member", position: 7, location: "Manila, PH",
            manager: "Ate Rosa", paymentStatus: "paid", nextDue: "Mar 1, 2026",
            nextPayoutWinner: "Member #4 â€” Lisa M.",
            lastBidDiscount: 300, activeMemberCount: 10, // R3 winner bid â‚±300
          },
          {
            id: "pool_edu", name: "Educ Circle", emoji: "ğŸ“š", members: 4, monthlyContribution: 2000,
            totalPot: 8000, currentRound: 1, totalRounds: 5, status: "forming",
            role: "member", position: 2, location: "Quezon City, PH",
            manager: "Kuya Ben", paymentStatus: "due", nextDue: "Feb 20, 2026",
            nextPayoutWinner: "Waiting for members...",
            lastBidDiscount: 0, activeMemberCount: 4,
          },
        ].map((circle) => {
          const isManager = circle.role === "manager";
          const isDue = circle.paymentStatus === "due";
          const isPaid = circle.paymentStatus === "paid";

          return (
            <div
              key={circle.id}
              onClick={() => onNavigate("circles")}
              style={{
                background: "linear-gradient(145deg, #111827, #1A2332)",
                borderRadius: 16, padding: "16px 18px", marginBottom: 8,
                border: isDue ? "1px solid rgba(245,158,11,0.2)" : "1px solid rgba(255,255,255,0.06)",
                cursor: "pointer", transition: "all 0.2s",
              }}
            >
              {/* Top Row: Name + Status */}
              <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 12 }}>
                <div style={{ width: 40, height: 40, borderRadius: 10, background: isManager ? "rgba(168,85,247,0.1)" : "rgba(0,177,79,0.08)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 20 }}>
                  {circle.emoji}
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    <span style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>{circle.name}</span>
                    <span style={{ fontSize: 8, padding: "2px 6px", borderRadius: 4, fontWeight: 700, background: isManager ? "rgba(168,85,247,0.15)" : "rgba(59,130,246,0.1)", color: isManager ? "#A855F7" : "#60A5FA" }}>
                      {isManager ? "MANAGER" : "MEMBER"}
                    </span>
                  </div>
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", marginTop: 2 }}>
                    {circle.members} members Â· Round {circle.currentRound}/{circle.totalRounds} Â· {isManager ? "Managed by You" : `Mgr: ${circle.manager}`}
                  </div>
                </div>
                <span style={{
                  padding: "4px 8px", borderRadius: 8, fontSize: 9, fontWeight: 700,
                  background: circle.status === "active" ? "rgba(0,177,79,0.12)" : "rgba(245,158,11,0.12)",
                  color: circle.status === "active" ? "#00D65B" : "#F59E0B",
                }}>
                  {circle.status === "active" ? "Active" : "Forming"}
                </span>
              </div>

              {/* Progress Bar */}
              <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 4, height: 4, marginBottom: 12 }}>
                <div style={{
                  width: `${(circle.currentRound / circle.totalRounds) * 100}%`,
                  height: "100%", borderRadius: 4,
                  background: circle.status === "active" ? "linear-gradient(90deg, #00B14F, #00D65B)" : "linear-gradient(90deg, #F59E0B, #FBBF24)",
                }} />
              </div>

              {/* Bottom Row: Payment Status + Amount Owed */}
              {(() => {
                const dividend = circle.lastBidDiscount > 0 ? Math.floor(circle.lastBidDiscount / (circle.activeMemberCount - 1)) : 0;
                const youOwe = circle.monthlyContribution - dividend;
                return (
                  <div>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-end" }}>
                      <div>
                        <div style={{ display: "flex", alignItems: "center", gap: 6, marginBottom: 4 }}>
                          <span style={{ width: 8, height: 8, borderRadius: "50%", background: isPaid ? "#00D65B" : "#F59E0B", boxShadow: isDue ? "0 0 6px rgba(245,158,11,0.4)" : "none" }} />
                          <span style={{ fontSize: 11, fontWeight: 600, color: isPaid ? "#00D65B" : "#F59E0B" }}>
                            {isPaid ? "Paid this round" : "Payment due"}
                          </span>
                        </div>
                        <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>
                          Due: {circle.nextDue} Â· Position #{circle.position}
                        </div>
                      </div>
                      <div style={{ textAlign: "right" }}>
                        <div style={{ fontSize: 14, fontWeight: 800, color: dividend > 0 ? "#00D65B" : "#fff" }}>
                          {formatCurrency(youOwe, r.symbol)}
                        </div>
                        {dividend > 0 && (
                          <div style={{ fontSize: 9, color: "#00D65B" }}>
                            <s style={{ color: "rgba(255,255,255,0.25)" }}>{formatCurrency(circle.monthlyContribution, r.symbol)}</s> -{formatCurrency(dividend, r.symbol)} dividend
                          </div>
                        )}
                        {dividend === 0 && (
                          <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)" }}>/mo</div>
                        )}
                      </div>
                    </div>

                    {/* Due payment alert with dividend */}
                    {isDue && (
                      <div style={{ marginTop: 10, padding: "8px 12px", background: "rgba(245,158,11,0.08)", borderRadius: 8, display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                        <div>
                          <div style={{ fontSize: 11, color: "#F59E0B", fontWeight: 600 }}>â° Due {circle.nextDue}</div>
                          {dividend > 0 && <div style={{ fontSize: 9, color: "#00D65B" }}>ğŸ Dividend applied</div>}
                        </div>
                        <button style={{ padding: "6px 14px", borderRadius: 6, border: "none", background: "linear-gradient(135deg, #F59E0B, #D97706)", color: "#fff", fontSize: 11, fontWeight: 700, cursor: "pointer" }}>
                          Pay {formatCurrency(youOwe, r.symbol)}
                        </button>
                      </div>
                    )}

                    {/* Paid confirmation */}
                    {isPaid && dividend > 0 && (
                      <div style={{ marginTop: 8, padding: "6px 10px", background: "rgba(0,177,79,0.06)", borderRadius: 6, fontSize: 9, color: "#00D65B" }}>
                        ğŸ Saved {formatCurrency(dividend, r.symbol)} from last round's bid dividend
                      </div>
                    )}
                  </div>
                );
              })()}

              {/* Next payout info */}
              <div style={{ marginTop: 8, padding: "6px 10px", background: "rgba(255,255,255,0.03)", borderRadius: 6, fontSize: 10, color: "rgba(255,255,255,0.3)" }}>
                Next Payout â†’ {circle.nextPayoutWinner}
              </div>
            </div>
          );
        })}
      </div>

      {/* Recent Activity */}
      <div>
        <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", marginBottom: 12 }}>
          Recent Activity
        </div>
        {[
          { type: "deposit", desc: "Cash In via GCash", amount: "+â‚±1,000.00", time: "2h ago", status: "confirmed" },
          { type: "contribution", desc: "Pool Contribution", amount: "-â‚±1,000.00", time: "1d ago", status: "confirmed" },
          { type: "payout", desc: "Round 2 Payout", amount: "+â‚±8,500.00", time: "5d ago", status: "confirmed" },
        ].map((tx, i) => (
          <div
            key={i}
            style={{
              display: "flex",
              justifyContent: "space-between",
              alignItems: "center",
              padding: "14px 0",
              borderBottom: i < 2 ? "1px solid rgba(255,255,255,0.04)" : "none",
            }}
          >
            <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
              <div
                style={{
                  width: 36,
                  height: 36,
                  borderRadius: 10,
                  background:
                    tx.type === "deposit"
                      ? "rgba(0,177,79,0.12)"
                      : tx.type === "payout"
                      ? "rgba(59,130,246,0.12)"
                      : "rgba(255,255,255,0.06)",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  fontSize: 16,
                }}
              >
                {tx.type === "deposit" ? "â†“" : tx.type === "payout" ? "â˜…" : "â†‘"}
              </div>
              <div>
                <div style={{ fontSize: 13, fontWeight: 600, color: "#fff" }}>
                  {tx.desc}
                </div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>
                  {tx.time}
                </div>
              </div>
            </div>
            <div
              style={{
                fontSize: 14,
                fontWeight: 700,
                color: tx.amount.startsWith("+") ? "#00D65B" : "#fff",
              }}
            >
              {tx.amount}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// â”€â”€â”€ Deposit / Cash-In Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DepositScreen({ region, onSubmit, onBack }) {
  const r = REGIONS[region];
  const [step, setStep] = useState("method"); // method -> amount -> receipt -> confirm
  const [method, setMethod] = useState(null);
  const [amount, setAmount] = useState("");
  const [reference, setReference] = useState("");
  const [receiptUploaded, setReceiptUploaded] = useState(false);
  const [submitting, setSubmitting] = useState(false);

  const presets = region === "PH" ? [500, 1000, 2000, 5000] : [10, 25, 50, 100];

  const handleSubmit = async () => {
    setSubmitting(true);
    await new Promise((r) => setTimeout(r, 1500));
    onSubmit({
      amount: Number(amount),
      method: method.id,
      reference,
      usdc: fiatToUSDC(Number(amount), r.rate),
      status: "pending",
    });
  };

  // Step: Select Payment Method
  if (step === "method") {
    return (
      <div style={{ padding: "0 20px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={onBack} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>
            â†
          </button>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Cash In</div>
          </div>
          <Logo size={24} variant="icon" />
        </div>

        <div style={{ fontSize: 13, color: "rgba(255,255,255,0.45)", marginBottom: 20 }}>
          Select your payment method
        </div>

        {r.methods.map((m) => (
          <button
            key={m.id}
            onClick={() => {
              setMethod(m);
              setStep("amount");
            }}
            style={{
              width: "100%",
              display: "flex",
              alignItems: "center",
              gap: 16,
              padding: "18px 20px",
              marginBottom: 10,
              background: "linear-gradient(145deg, #111827, #1A2332)",
              border: "1px solid rgba(255,255,255,0.06)",
              borderRadius: 16,
              color: "#fff",
              cursor: "pointer",
              transition: "all 0.2s",
            }}
          >
            <div
              style={{
                width: 46,
                height: 46,
                borderRadius: 12,
                background: `${m.color}22`,
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontSize: 22,
              }}
            >
              {m.icon}
            </div>
            <div style={{ flex: 1, textAlign: "left" }}>
              <div style={{ fontSize: 15, fontWeight: 700 }}>{m.name}</div>
              <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", marginTop: 2 }}>
                {m.id === "gcash" ? "Instant Â· No fee" : m.id === "maya" ? "Instant Â· No fee" : "1-2 business days"}
              </div>
            </div>
            <span style={{ color: "rgba(255,255,255,0.3)", fontSize: 18 }}>â€º</span>
          </button>
        ))}

        {/* Info Card */}
        <div
          style={{
            marginTop: 20,
            padding: "16px 18px",
            background: "rgba(59,130,246,0.08)",
            borderRadius: 14,
            border: "1px solid rgba(59,130,246,0.15)",
          }}
        >
          <div style={{ fontSize: 12, fontWeight: 700, color: "#60A5FA", marginBottom: 6 }}>
            How it works
          </div>
          <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", lineHeight: 1.6 }}>
            Your {r.currency} payment via GCash/Maya is recorded on the blockchain for
            personal vault. This protects your savings from currency fluctuation.
          </div>
        </div>
      </div>
    );
  }

  // Step: Amount Entry
  if (step === "amount") {
    const usdcPreview = amount ? fiatToUSDC(Number(amount), r.rate) : "0.000000";
    return (
      <div style={{ padding: "0 20px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={() => setStep("method")} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>
            â†
          </button>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Cash In via {method.name}</div>
          </div>
          <Logo size={24} variant="icon" />
        </div>

        {/* Amount Card */}
        <div
          style={{
            background: "linear-gradient(145deg, #111827, #1A2332)",
            borderRadius: 20,
            padding: "28px 24px",
            border: "1px solid rgba(255,255,255,0.06)",
            marginBottom: 20,
            textAlign: "center",
          }}
        >
          <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", fontWeight: 600, marginBottom: 16, letterSpacing: 0.5 }}>
            ENTER AMOUNT
          </div>
          <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 4, marginBottom: 8 }}>
            <span style={{ fontSize: 32, fontWeight: 300, color: "rgba(255,255,255,0.4)" }}>{r.symbol}</span>
            <input
              type="number"
              value={amount}
              onChange={(e) => setAmount(e.target.value)}
              placeholder="0.00"
              autoFocus
              style={{
                background: "none",
                border: "none",
                outline: "none",
                color: "#fff",
                fontSize: 42,
                fontWeight: 800,
                width: "180px",
                textAlign: "center",
                fontFamily: "'SF Pro Display', -apple-system, sans-serif",
              }}
            />
          </div>
          <div
            style={{
              fontSize: 13,
              color: "rgba(255,255,255,0.35)",
              padding: "8px 16px",
              background: "rgba(255,255,255,0.04)",
              borderRadius: 20,
              display: "inline-block",
            }}
          >
            ğŸ”— Will be blockchain-verified
          </div>

          {/* Preset Amounts */}
          <div style={{ display: "flex", gap: 8, marginTop: 20, justifyContent: "center", flexWrap: "wrap" }}>
            {presets.map((p) => (
              <button
                key={p}
                onClick={() => setAmount(String(p))}
                style={{
                  padding: "8px 18px",
                  borderRadius: 20,
                  border: amount === String(p) ? "1px solid #00B14F" : "1px solid rgba(255,255,255,0.1)",
                  background: amount === String(p) ? "rgba(0,177,79,0.12)" : "rgba(255,255,255,0.04)",
                  color: amount === String(p) ? "#00D65B" : "rgba(255,255,255,0.6)",
                  fontSize: 13,
                  fontWeight: 600,
                  cursor: "pointer",
                  transition: "all 0.15s",
                }}
              >
                {r.symbol}{p.toLocaleString()}
              </button>
            ))}
          </div>
        </div>

        {/* Exchange Rate Info */}
        <div
          style={{
            display: "flex",
            justifyContent: "space-between",
            padding: "14px 18px",
            background: "rgba(255,255,255,0.03)",
            borderRadius: 12,
            marginBottom: 20,
            fontSize: 13,
          }}
        >
          <span style={{ color: "rgba(255,255,255,0.4)" }}>Exchange Rate</span>
          <span style={{ color: "#fff", fontWeight: 600 }}>Secured by blockchain audit trail</span>
        </div>

        <button
          onClick={() => amount && Number(amount) > 0 && setStep("receipt")}
          disabled={!amount || Number(amount) <= 0}
          style={{
            width: "100%",
            padding: "16px",
            borderRadius: 14,
            border: "none",
            background:
              amount && Number(amount) > 0
                ? "linear-gradient(135deg, #00B14F, #00D65B)"
                : "rgba(255,255,255,0.06)",
            color: amount && Number(amount) > 0 ? "#fff" : "rgba(255,255,255,0.2)",
            fontSize: 15,
            fontWeight: 700,
            cursor: amount && Number(amount) > 0 ? "pointer" : "not-allowed",
            transition: "all 0.2s",
            boxShadow: amount && Number(amount) > 0 ? "0 4px 20px rgba(0,177,79,0.3)" : "none",
          }}
        >
          Continue
        </button>
      </div>
    );
  }

  // Step: Receipt / Reference Upload (MVP Manual Flow)
  if (step === "receipt") {
    return (
      <div style={{ padding: "0 20px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={() => setStep("amount")} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>
            â†
          </button>
          <div style={{ flex: 1, fontSize: 18, fontWeight: 700, color: "#fff" }}>Verify Payment</div>
          <Logo size={24} variant="icon" />
        </div>

        {/* Instructions Card */}
        <div
          style={{
            background: "linear-gradient(145deg, #0D3320, #112B1D)",
            borderRadius: 16,
            padding: "20px",
            border: "1px solid rgba(0,177,79,0.2)",
            marginBottom: 20,
          }}
        >
          <div style={{ fontSize: 14, fontWeight: 700, color: "#00D65B", marginBottom: 12 }}>
            Send {formatCurrency(amount, r.symbol)} to:
          </div>
          <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 12 }}>
            <div
              style={{
                width: 44,
                height: 44,
                borderRadius: 12,
                background: `${method.color}22`,
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                fontSize: 20,
              }}
            >
              {method.icon}
            </div>
            <div>
              <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>
                Pool Manager
              </div>
              <div style={{ fontSize: 14, color: "rgba(255,255,255,0.6)", fontFamily: "monospace" }}>
                0917-XXX-4532
              </div>
            </div>
          </div>
          <div style={{ padding: "10px 14px", background: "rgba(0,0,0,0.2)", borderRadius: 10, fontSize: 12, color: "rgba(255,255,255,0.5)", lineHeight: 1.5 }}>
            Open your {method.name} app â†’ Send Money â†’ Enter the number above â†’ Send {formatCurrency(amount, r.symbol)} â†’ Copy the reference number below.
          </div>
        </div>

        {/* Reference Number Input */}
        <div style={{ marginBottom: 16 }}>
          <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 8, letterSpacing: 0.5 }}>
            REFERENCE NUMBER
          </label>
          <input
            type="text"
            value={reference}
            onChange={(e) => setReference(e.target.value)}
            placeholder="e.g. 1234 5678 9012"
            style={{
              width: "100%",
              padding: "14px 16px",
              borderRadius: 12,
              border: "1px solid rgba(255,255,255,0.1)",
              background: "rgba(255,255,255,0.04)",
              color: "#fff",
              fontSize: 16,
              fontFamily: "monospace",
              outline: "none",
              letterSpacing: 1,
              boxSizing: "border-box",
            }}
          />
        </div>

        {/* Screenshot Upload */}
        <div style={{ marginBottom: 24 }}>
          <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 8, letterSpacing: 0.5 }}>
            UPLOAD RECEIPT (OPTIONAL)
          </label>
          <button
            onClick={() => setReceiptUploaded(true)}
            style={{
              width: "100%",
              padding: "28px 16px",
              borderRadius: 12,
              border: receiptUploaded ? "2px solid #00B14F" : "2px dashed rgba(255,255,255,0.1)",
              background: receiptUploaded ? "rgba(0,177,79,0.08)" : "rgba(255,255,255,0.02)",
              color: receiptUploaded ? "#00D65B" : "rgba(255,255,255,0.3)",
              fontSize: 13,
              fontWeight: 600,
              cursor: "pointer",
              transition: "all 0.2s",
              display: "flex",
              flexDirection: "column",
              alignItems: "center",
              gap: 6,
            }}
          >
            <span style={{ fontSize: 28 }}>{receiptUploaded ? "âœ“" : "ğŸ“·"}</span>
            {receiptUploaded ? "Receipt Uploaded" : "Tap to upload screenshot"}
          </button>
        </div>

        {/* Summary */}
        <div
          style={{
            background: "rgba(255,255,255,0.03)",
            borderRadius: 14,
            padding: "16px 18px",
            marginBottom: 20,
          }}
        >
          <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 10, fontSize: 13 }}>
            <span style={{ color: "rgba(255,255,255,0.4)" }}>You Send</span>
            <span style={{ color: "#fff", fontWeight: 700 }}>{formatCurrency(amount, r.symbol)}</span>
          </div>
          <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 10, fontSize: 13 }}>
            <span style={{ color: "rgba(255,255,255,0.4)" }}>You Receive</span>
            <span style={{ color: "#00D65B", fontWeight: 700 }}>"Blockchain verified"</span>
          </div>
          <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13 }}>
            <span style={{ color: "rgba(255,255,255,0.4)" }}>Fee</span>
            <span style={{ color: "#fff", fontWeight: 600 }}>Free</span>
          </div>
        </div>

        <button
          onClick={handleSubmit}
          disabled={!reference || submitting}
          style={{
            width: "100%",
            padding: "16px",
            borderRadius: 14,
            border: "none",
            background: reference
              ? "linear-gradient(135deg, #00B14F, #00D65B)"
              : "rgba(255,255,255,0.06)",
            color: reference ? "#fff" : "rgba(255,255,255,0.2)",
            fontSize: 15,
            fontWeight: 700,
            cursor: reference ? "pointer" : "not-allowed",
            transition: "all 0.2s",
            boxShadow: reference ? "0 4px 20px rgba(0,177,79,0.3)" : "none",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            gap: 8,
          }}
        >
          {submitting ? (
            <>
              <span style={{ display: "inline-block", animation: "spin 1s linear infinite", fontSize: 16 }}>âŸ³</span>
              Processing...
            </>
          ) : (
            "Submit for Verification"
          )}
        </button>
      </div>
    );
  }

  return null;
}

// â”€â”€â”€ Bidding Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BidScreen({ region }) {
  const r = REGIONS[region];
  const [selectedBidCircle, setSelectedBidCircle] = useState(null);
  const [bidAmount, setBidAmount] = useState("");
  const [bidPlaced, setBidPlaced] = useState(false);
  const [timeLeft, setTimeLeft] = useState(0);

  useEffect(() => {
    if (selectedBidCircle && selectedBidCircle.bidOpen) {
      setTimeLeft(selectedBidCircle.bidTimeLeft);
      const timer = setInterval(() => setTimeLeft((t) => Math.max(0, t - 1)), 1000);
      return () => clearInterval(timer);
    }
  }, [selectedBidCircle]);

  const formatTimer = (s) => {
    const hrs = Math.floor(s / 3600);
    const mins = Math.floor((s % 3600) / 60);
    const secs = s % 60;
    return `${hrs.toString().padStart(2, "0")}:${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
  };

  // All circles user is in with bid status
  const myBidCircles = [
    {
      id: "c1", name: "Bahay Fund", emoji: "ğŸ ", members: 10, monthlyContribution: 1000,
      totalPot: 10000, currentRound: 3, totalRounds: 10, status: "active",
      bidOpen: true, bidTimeLeft: 86400,
      bidCloseDate: "Feb 18, 2026 Â· 6:00 PM",
      platformFeePercent: 2.0, managerFeePercent: 1.5,
      managerMessage: "Bidding is open for Round 4! Remember: highest discount wins the pot. Good luck everyone! ğŸ€ â€” Ate Rosa",
      allMembers: [
        { name: "Ate Rosa", avatar: "AR", position: 1, role: "manager" },
        { name: "Rico P.", avatar: "RP", position: 2 },
        { name: "Kuya Ben", avatar: "KB", position: 3 },
        { name: "Lisa M.", avatar: "LM", position: 4 },
        { name: "Juan D.", avatar: "JC", position: 5 },
        { name: "Ana R.", avatar: "An", position: 6 },
        { name: "Maria S.", avatar: "MS", position: 7, isMe: true },
        { name: "Grace L.", avatar: "GL", position: 8 },
        { name: "Mark T.", avatar: "MT", position: 9 },
        { name: "Nina C.", avatar: "NC", position: 10 },
      ],
      previousWinners: [
        { round: 1, name: "Rico P.", avatar: "RP", bid: 400, position: 2 },
        { round: 2, name: "Mark T.", avatar: "MT", bid: 550, position: 9 },
        { round: 3, name: "Kuya Ben", avatar: "KB", bid: 300, position: 3 },
      ],
      currentBids: [
        { user: "Juan D.", avatar: "JC", amount: 800, time: Date.now() - 120000, position: 5 },
        { user: "Ana R.", avatar: "An", amount: 650, time: Date.now() - 300000, position: 6 },
        { user: "Lisa M.", avatar: "LM", amount: 900, time: Date.now() - 600000, position: 4 },
      ],
      myPosition: 7,
      alreadyWon: false,
    },
    {
      id: "c2", name: "Educ Circle", emoji: "ğŸ“š", members: 4, monthlyContribution: 2000,
      totalPot: 8000, currentRound: 1, totalRounds: 5, status: "forming",
      bidOpen: false, bidTimeLeft: 0,
      bidCloseDate: null,
      managerMessage: "Circle still forming. Bidding starts once we have all 5 members. â€” Kuya Ben",
      previousWinners: [],
      currentBids: [],
      myPosition: 2,
      alreadyWon: false,
      notReady: true,
    },
  ];

  const placeBid = () => {
    if (!bidAmount || Number(bidAmount) <= 0 || !selectedBidCircle) return;
    const newBid = { user: "You (Maria S.)", avatar: "MS", amount: Number(bidAmount), time: Date.now(), isYou: true, position: selectedBidCircle.myPosition };
    selectedBidCircle.currentBids = [newBid, ...selectedBidCircle.currentBids].sort((a, b) => b.amount - a.amount);
    setBidPlaced(true);
    setBidAmount("");
  };

  // Circle Selector
  if (!selectedBidCircle) {
    return (
      <div style={{ padding: "0 20px 20px" }}>
        <div style={{ padding: "16px 0", display: "flex", justifyContent: "space-between", alignItems: "flex-start" }}>
          <div>
            <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Bidding</div>
            <div style={{ fontSize: 13, color: "rgba(255,255,255,0.4)", marginTop: 2 }}>Select a circle to bid on this round's pot</div>
          </div>
          <Logo size={28} variant="icon" />
        </div>

        {myBidCircles.map((c) => {
          const isWinner = c.alreadyWon;
          return (
            <div
              key={c.id}
              onClick={() => { if (!c.notReady && !isWinner) { setSelectedBidCircle(c); setBidPlaced(false); setBidAmount(""); } }}
              style={{
                background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", marginBottom: 10,
                border: c.bidOpen ? "1px solid rgba(168,85,247,0.15)" : "1px solid rgba(255,255,255,0.06)",
                cursor: c.notReady || isWinner ? "not-allowed" : "pointer",
                opacity: c.notReady || isWinner ? 0.5 : 1,
              }}
            >
              <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 12 }}>
                <div style={{ width: 44, height: 44, borderRadius: 12, background: c.bidOpen ? "rgba(168,85,247,0.1)" : "rgba(255,255,255,0.05)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22 }}>{c.emoji}</div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>{c.name}</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 2 }}>{c.members} members Â· Round {c.currentRound}/{c.totalRounds}</div>
                </div>
                <span style={{
                  padding: "5px 10px", borderRadius: 8, fontSize: 10, fontWeight: 700,
                  background: c.bidOpen ? "rgba(168,85,247,0.15)" : isWinner ? "rgba(0,177,79,0.12)" : "rgba(255,255,255,0.06)",
                  color: c.bidOpen ? "#A855F7" : isWinner ? "#00D65B" : "rgba(255,255,255,0.3)",
                }}>
                  {c.bidOpen ? `ğŸ”¥ Open Â· ${c.currentBids.length} bids` : isWinner ? "Already Won âœ“" : c.notReady ? "Not Ready" : "Closed"}
                </span>
              </div>

              <div style={{ display: "flex", justifyContent: "space-between", fontSize: 11 }}>
                <div>
                  <span style={{ color: "rgba(255,255,255,0.35)" }}>Pot: </span>
                  <span style={{ color: "#00D65B", fontWeight: 700 }}>{formatCurrency(c.totalPot, r.symbol)}</span>
                </div>
                <div>
                  <span style={{ color: "rgba(255,255,255,0.35)" }}>Your Position: </span>
                  <span style={{ color: "#60A5FA", fontWeight: 700 }}>#{c.myPosition}</span>
                </div>
              </div>

              {c.previousWinners.length > 0 && (
                <div style={{ marginTop: 10, display: "flex", gap: 4, flexWrap: "wrap" }}>
                  {c.previousWinners.map((w, i) => (
                    <span key={i} style={{ fontSize: 9, padding: "3px 6px", borderRadius: 4, background: "rgba(0,177,79,0.08)", color: "#00D65B", display: "flex", alignItems: "center", gap: 3 }}>
                      ğŸ† R{w.round}: {w.name}
                    </span>
                  ))}
                </div>
              )}

              {c.notReady && (
                <div style={{ marginTop: 8, fontSize: 10, color: "rgba(255,255,255,0.3)", fontStyle: "italic" }}>{c.managerMessage}</div>
              )}
            </div>
          );
        })}

        {/* How bidding works */}
        <div style={{ marginTop: 8, padding: "16px", background: "rgba(168,85,247,0.06)", borderRadius: 14, border: "1px solid rgba(168,85,247,0.1)" }}>
          <div style={{ fontSize: 11, fontWeight: 700, color: "#A855F7", marginBottom: 10 }}>HOW BIDDING WORKS</div>
          {[
            { icon: "ğŸ“ˆ", title: "Highest discount wins", desc: "Offer the biggest discount â€” the group shares your sacrifice" },
            { icon: "â±", title: "24-hour window", desc: "Bidding opens and closes within 24 hours" },
            { icon: "ğŸ†", title: "One win per cycle", desc: "Previous winners cannot bid again" },
            { icon: "ğŸ’°", title: "Winner receives", desc: "Pot minus your discount minus fees â€” you get early access" },
          ].map((item, i) => (
            <div key={i} style={{ display: "flex", gap: 10, padding: "5px 0" }}>
              <span style={{ fontSize: 14 }}>{item.icon}</span>
              <div>
                <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.6)" }}>{item.title}</div>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>{item.desc}</div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  // Bid Detail View
  const bc = selectedBidCircle;
  const allBids = [...bc.currentBids].sort((a, b) => b.amount - a.amount);
  const highestBid = allBids.length > 0 ? allBids[0].amount : null;
  const topBidder = allBids.length > 0 ? allBids[0] : null;
  const isUrgent = timeLeft < 3600;
  const totalFeePercent = 3.5;

  return (
    <div style={{ padding: "0 20px 20px" }}>
      {/* Header */}
      <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
        <button onClick={() => { setSelectedBidCircle(null); setBidPlaced(false); }} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
        <div style={{ flex: 1 }}>
          <div style={{ fontSize: 16, fontWeight: 700, color: "#fff" }}>{bc.emoji} {bc.name} â€” Round {bc.currentRound + 1} Bid</div>
          <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>{bc.members} members Â· Pot: {formatCurrency(bc.totalPot, r.symbol)}</div>
        </div>
        <Logo size={24} variant="icon" />
      </div>

      {/* Manager Message */}
      {bc.managerMessage && (
        <div style={{ padding: "12px 14px", background: "rgba(168,85,247,0.06)", borderRadius: 12, border: "1px solid rgba(168,85,247,0.1)", marginBottom: 14, display: "flex", gap: 10, alignItems: "flex-start" }}>
          <span style={{ fontSize: 16 }}>ğŸ“¢</span>
          <div>
            <div style={{ fontSize: 10, fontWeight: 700, color: "#A855F7", marginBottom: 3, letterSpacing: 0.3 }}>MANAGER MESSAGE</div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.5)", lineHeight: 1.5, fontStyle: "italic" }}>"{bc.managerMessage}"</div>
          </div>
        </div>
      )}

      {/* Timer Card */}
      <div style={{
        background: isUrgent ? "linear-gradient(145deg, #2D1215, #1A0A0C)" : "linear-gradient(145deg, #1A1125, #231530)",
        borderRadius: 20, padding: "24px", marginBottom: 16, textAlign: "center",
        border: isUrgent ? "1px solid rgba(239,68,68,0.2)" : "1px solid rgba(168,85,247,0.15)",
      }}>
        <div style={{ fontSize: 11, color: isUrgent ? "#EF4444" : "rgba(255,255,255,0.4)", fontWeight: 600, letterSpacing: 1, marginBottom: 8 }}>
          {isUrgent ? "âš¡ CLOSING SOON" : "BIDDING CLOSES IN"}
        </div>
        <div style={{ fontSize: 44, fontWeight: 800, color: isUrgent ? "#EF4444" : "#A855F7", fontFamily: "monospace", letterSpacing: 2 }}>
          {formatTimer(timeLeft)}
        </div>
        <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", marginTop: 6 }}>Closes: {bc.bidCloseDate}</div>
        <div style={{ display: "flex", justifyContent: "center", gap: 16, marginTop: 14 }}>
          <div>
            <div style={{ fontSize: 16, fontWeight: 800, color: "#00D65B" }}>{formatCurrency(bc.totalPot, r.symbol)}</div>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Pot Size</div>
          </div>
          <div style={{ width: 1, background: "rgba(255,255,255,0.06)" }} />
          <div>
            <div style={{ fontSize: 16, fontWeight: 800, color: "#fff" }}>{allBids.length}</div>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Bids</div>
          </div>
          <div style={{ width: 1, background: "rgba(255,255,255,0.06)" }} />
          <div>
            <div style={{ fontSize: 16, fontWeight: 800, color: "#60A5FA" }}>#{bc.myPosition}</div>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Your Pos.</div>
          </div>
        </div>
      </div>

      {/* Current Top Bidder */}
      {topBidder && (
        <div style={{ background: "linear-gradient(145deg, #0A1628, #111827)", borderRadius: 14, padding: "14px 16px", border: "1px solid rgba(245,158,11,0.15)", marginBottom: 12, display: "flex", alignItems: "center", gap: 12 }}>
          <div style={{ width: 40, height: 40, borderRadius: "50%", background: "linear-gradient(135deg, #F59E0B, #D97706)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 700, color: "#fff" }}>{topBidder.avatar}</div>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 600, letterSpacing: 0.3 }}>CURRENT HIGHEST DISCOUNT</div>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>{topBidder.user} {topBidder.isYou ? "(You!)" : ""}</div>
          </div>
          <div style={{ textAlign: "right" }}>
            <div style={{ fontSize: 18, fontWeight: 800, color: "#FBBF24" }}>{formatCurrency(topBidder.amount, r.symbol)}</div>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)" }}>Gets {formatCurrency(bc.totalPot - topBidder.amount, r.symbol)}</div>
          </div>
        </div>
      )}

      {/* Bid Input */}
      <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
        <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", fontWeight: 600, marginBottom: 10, letterSpacing: 0.3 }}>
          YOUR DISCOUNT (higher = more likely to win)
        </div>
        <div style={{ display: "flex", gap: 10 }}>
          <div style={{ flex: 1, position: "relative" }}>
            <span style={{ position: "absolute", left: 14, top: "50%", transform: "translateY(-50%)", color: "rgba(255,255,255,0.3)", fontSize: 16 }}>{r.symbol}</span>
            <input
              type="number" value={bidAmount} onChange={(e) => setBidAmount(e.target.value)} placeholder="0"
              style={{ width: "100%", padding: "14px 14px 14px 32px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 18, fontWeight: 700, outline: "none", boxSizing: "border-box" }}
            />
          </div>
          <button onClick={placeBid} disabled={bidPlaced || timeLeft === 0}
            style={{
              padding: "14px 24px", borderRadius: 12, border: "none",
              background: bidPlaced || timeLeft === 0 ? "rgba(255,255,255,0.06)" : "linear-gradient(135deg, #A855F7, #7C3AED)",
              color: bidPlaced || timeLeft === 0 ? "rgba(255,255,255,0.3)" : "#fff", fontSize: 14, fontWeight: 700,
              cursor: bidPlaced || timeLeft === 0 ? "not-allowed" : "pointer",
              boxShadow: bidPlaced ? "none" : "0 4px 20px rgba(168,85,247,0.3)",
            }}
          >
            {bidPlaced ? "Placed âœ“" : timeLeft === 0 ? "Closed" : "Bid"}
          </button>
        </div>
        {bidAmount && Number(bidAmount) > 0 && (
          <div style={{ padding: "10px 12px", background: "rgba(255,255,255,0.03)", borderRadius: 8, marginTop: 10 }}>
            <div style={{ display: "flex", justifyContent: "space-between", fontSize: 11, marginBottom: 4 }}>
              <span style={{ color: "rgba(255,255,255,0.35)" }}>Your discount (interest to group)</span>
              <span style={{ color: "#FBBF24", fontWeight: 700 }}>{formatCurrency(Number(bidAmount), r.symbol)}</span>
            </div>
            <div style={{ display: "flex", justifyContent: "space-between", fontSize: 11, marginBottom: 4 }}>
              <span style={{ color: "rgba(255,255,255,0.35)" }}>Fees ({totalFeePercent}%)</span>
              <span style={{ color: "rgba(255,255,255,0.4)" }}>-{formatCurrency(bc.totalPot * totalFeePercent / 100, r.symbol)}</span>
            </div>
            <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "6px 0" }} />
            <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13, marginBottom: 4 }}>
              <span style={{ color: "rgba(255,255,255,0.5)", fontWeight: 600 }}>You'd receive</span>
              <span style={{ color: "#00D65B", fontWeight: 800 }}>{formatCurrency(bc.totalPot - Number(bidAmount) - (bc.totalPot * totalFeePercent / 100), r.symbol)}</span>
            </div>
            <div style={{ height: 1, background: "rgba(255,255,255,0.04)", margin: "6px 0" }} />
            <div style={{ display: "flex", justifyContent: "space-between", fontSize: 11 }}>
              <span style={{ color: "rgba(255,255,255,0.3)" }}>Dividend each member gets</span>
              <span style={{ color: "#00D65B", fontWeight: 600 }}>{formatCurrency(Math.floor(Math.max(0, Number(bidAmount) - (bc.totalPot * totalFeePercent / 100)) / (bc.members - 1)), r.symbol)}</span>
            </div>
          </div>
        )}
      </div>

      {/* â”€â”€â”€ Dividends Calculator â”€â”€â”€ */}
      {(() => {
        const winningBid = allBids.length > 0 ? allBids[0].amount : 0;
        const platformFee = bc.totalPot * (bc.platformFeePercent || 2) / 100;
        const managerFee = bc.totalPot * (bc.managerFeePercent || 1.5) / 100;
        const totalFees = platformFee + managerFee;
        const distributable = Math.max(0, winningBid - totalFees);
        const dividendPerPerson = bc.members > 1 ? distributable / (bc.members - 1) : 0;
        return (
          <div style={{ background: "linear-gradient(145deg, #0A1628, #111827)", borderRadius: 16, padding: "18px", border: "1px solid rgba(0,177,79,0.12)", marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 14 }}>
              <span style={{ fontSize: 16 }}>ğŸ’¸</span>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#00D65B" }}>Estimated Dividends</div>
              <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(0,177,79,0.12)", color: "#00D65B", fontWeight: 700, marginLeft: "auto" }}>
                PER MEMBER
              </span>
            </div>
            <div style={{ textAlign: "center", marginBottom: 14 }}>
              <div style={{ fontSize: 28, fontWeight: 800, color: "#00D65B" }}>{formatCurrency(Math.floor(dividendPerPerson), r.symbol)}</div>
              <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>discount on your next payment</div>
            </div>
            <div style={{ padding: "12px", background: "rgba(255,255,255,0.03)", borderRadius: 10 }}>
              {[
                { label: "Winning Bid (Interest)", value: formatCurrency(winningBid, r.symbol), color: "#FBBF24" },
                { label: `Platform Fee (${bc.platformFeePercent || 2}%)`, value: `-${formatCurrency(platformFee, r.symbol)}`, color: "#EF4444" },
                { label: `Manager Fee (${bc.managerFeePercent || 1.5}%)`, value: `-${formatCurrency(managerFee, r.symbol)}`, color: "#EF4444" },
                { label: "Distributable Amount", value: formatCurrency(distributable, r.symbol), color: "#fff", bold: true, divider: true },
                { label: `Ã· ${bc.members - 1} other members`, value: formatCurrency(Math.floor(dividendPerPerson), r.symbol), color: "#00D65B", bold: true },
              ].map((row, i) => (
                <div key={i}>
                  {row.divider && <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "6px 0" }} />}
                  <div style={{ display: "flex", justifyContent: "space-between", padding: "4px 0", fontSize: 11 }}>
                    <span style={{ color: "rgba(255,255,255,0.4)" }}>{row.label}</span>
                    <span style={{ color: row.color, fontWeight: row.bold ? 800 : 600 }}>{row.value}</span>
                  </div>
                </div>
              ))}
            </div>
            <div style={{ marginTop: 10, fontSize: 10, color: "rgba(255,255,255,0.25)", textAlign: "center", lineHeight: 1.5 }}>
              The winner pays an "interest" (their bid). After fees, the remaining amount is split equally among all other members as a discount.
            </div>
          </div>
        );
      })()}

      {/* â”€â”€â”€ ğŸŸ¢ Active Bidders (The Arena) â”€â”€â”€ */}
      <div style={{ marginBottom: 16 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }}>
          <span style={{ width: 10, height: 10, borderRadius: "50%", background: "#00D65B", boxShadow: "0 0 8px rgba(0,177,79,0.4)" }} />
          <span style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>Active Bidders</span>
          <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(0,177,79,0.1)", color: "#00D65B", fontWeight: 700 }}>
            THE ARENA
          </span>
          <span style={{ fontSize: 10, color: "rgba(255,255,255,0.3)", marginLeft: "auto" }}>{allBids.length} bids Â· Highest wins</span>
        </div>

        {/* Members who placed bids â€” sorted by bid amount desc */}
        {allBids.map((bid, i) => (
          <div key={"bid-" + i} style={{
            display: "flex", alignItems: "center", gap: 10, padding: "12px 14px", marginBottom: 4, borderRadius: 10,
            background: bid.isYou ? "rgba(168,85,247,0.08)" : i === 0 ? "rgba(245,158,11,0.08)" : "rgba(255,255,255,0.03)",
            border: bid.isYou ? "1px solid rgba(168,85,247,0.2)" : i === 0 ? "1px solid rgba(245,158,11,0.12)" : "1px solid rgba(255,255,255,0.04)",
          }}>
            <span style={{ fontSize: 12, fontWeight: 800, color: i === 0 ? "#FBBF24" : "rgba(255,255,255,0.2)", width: 20, textAlign: "center" }}>
              {i === 0 ? "ğŸ‘‘" : `#${i + 1}`}
            </span>
            <div style={{ width: 30, height: 30, borderRadius: "50%", background: bid.isYou ? "linear-gradient(135deg, #A855F7, #7C3AED)" : i === 0 ? "linear-gradient(135deg, #F59E0B, #D97706)" : "rgba(255,255,255,0.08)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 700, color: "#fff" }}>{bid.avatar}</div>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 12, fontWeight: 600, color: "#fff" }}>{bid.user} {bid.isYou ? "(you)" : ""}</div>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)" }}>Position #{bid.position}</div>
            </div>
            <div style={{ textAlign: "right" }}>
              <div style={{ fontSize: 14, fontWeight: 700, color: i === 0 ? "#FBBF24" : "#fff" }}>{formatCurrency(bid.amount, r.symbol)}</div>
              <div style={{ fontSize: 8, color: "rgba(255,255,255,0.2)" }}>Gets {formatCurrency(bc.totalPot - bid.amount, r.symbol)}</div>
            </div>
          </div>
        ))}

        {/* Eligible members who haven't bid yet */}
        {(() => {
          const bidderNames = allBids.map(b => b.user.replace(" (Maria S.)", ""));
          const winnerNames = bc.previousWinners.map(w => w.name);
          const waitingMembers = (bc.allMembers || []).filter(m =>
            !winnerNames.includes(m.name) &&
            !bidderNames.includes(m.name) &&
            !m.name.includes("Maria") // already shown if bid placed
          );
          if (waitingMembers.length === 0) return null;
          return (
            <div style={{ marginTop: 6 }}>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.2)", padding: "6px 0", letterSpacing: 0.3 }}>ELIGIBLE â€” WAITING TO BID</div>
              {waitingMembers.map((m, i) => (
                <div key={"wait-" + i} style={{
                  display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", marginBottom: 3, borderRadius: 8,
                  background: "rgba(255,255,255,0.02)", border: "1px dashed rgba(255,255,255,0.06)",
                }}>
                  <span style={{ width: 20, textAlign: "center", fontSize: 10, color: "rgba(255,255,255,0.15)" }}>â€”</span>
                  <div style={{ width: 30, height: 30, borderRadius: "50%", background: "rgba(255,255,255,0.06)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.4)" }}>{m.avatar}</div>
                  <div style={{ flex: 1 }}>
                    <div style={{ fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)" }}>{m.name} {m.isMe ? "(you)" : ""} {m.role === "manager" ? "Â· Mgr" : ""}</div>
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.2)" }}>Position #{m.position}</div>
                  </div>
                  <span style={{ fontSize: 9, padding: "2px 8px", borderRadius: 4, background: "rgba(255,255,255,0.04)", color: "rgba(255,255,255,0.25)" }}>No bid yet</span>
                </div>
              ))}
            </div>
          );
        })()}
      </div>

      {/* â”€â”€â”€ âš« Past Winners (The Bench) â”€â”€â”€ */}
      {bc.previousWinners.length > 0 && (
        <div style={{ marginBottom: 16 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }}>
            <span style={{ width: 10, height: 10, borderRadius: "50%", background: "rgba(255,255,255,0.15)", border: "1px solid rgba(255,255,255,0.1)" }} />
            <span style={{ fontSize: 13, fontWeight: 700, color: "rgba(255,255,255,0.4)" }}>Past Winners</span>
            <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(255,255,255,0.04)", color: "rgba(255,255,255,0.25)", fontWeight: 700 }}>
              THE BENCH
            </span>
          </div>
          {bc.previousWinners.map((w, i) => (
            <div key={"winner-" + i} style={{
              display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", marginBottom: 3, borderRadius: 8,
              background: "rgba(255,255,255,0.02)", border: "1px solid rgba(255,255,255,0.03)", opacity: 0.5,
            }}>
              <span style={{ fontSize: 14, width: 20, textAlign: "center" }}>ğŸ†</span>
              <div style={{ width: 30, height: 30, borderRadius: "50%", background: "rgba(255,255,255,0.06)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.4)" }}>{w.avatar}</div>
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)" }}>
                  {w.name} <span style={{ color: "#FBBF24", fontSize: 10 }}>ğŸ† WON (Round {w.round})</span>
                </div>
                <div style={{ fontSize: 9, color: "rgba(255,255,255,0.2)" }}>Bid was {formatCurrency(w.bid, r.symbol)} Â· Cannot bid again</div>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* Summary bar */}
      <div style={{ display: "flex", gap: 6 }}>
        <div style={{ flex: 1, padding: "10px", background: "rgba(0,177,79,0.06)", borderRadius: 8, textAlign: "center" }}>
          <div style={{ fontSize: 14, fontWeight: 800, color: "#00D65B" }}>{bc.members - bc.previousWinners.length}</div>
          <div style={{ fontSize: 8, color: "rgba(255,255,255,0.3)" }}>Eligible</div>
        </div>
        <div style={{ flex: 1, padding: "10px", background: "rgba(245,158,11,0.06)", borderRadius: 8, textAlign: "center" }}>
          <div style={{ fontSize: 14, fontWeight: 800, color: "#FBBF24" }}>{allBids.length}</div>
          <div style={{ fontSize: 8, color: "rgba(255,255,255,0.3)" }}>Bids Placed</div>
        </div>
        <div style={{ flex: 1, padding: "10px", background: "rgba(255,255,255,0.03)", borderRadius: 8, textAlign: "center" }}>
          <div style={{ fontSize: 14, fontWeight: 800, color: "rgba(255,255,255,0.4)" }}>{bc.previousWinners.length}</div>
          <div style={{ fontSize: 8, color: "rgba(255,255,255,0.3)" }}>On Bench</div>
        </div>
      </div>
    </div>
  );
}
function SettingsScreen({ user, region, onRegionChange }) {
  const [showWallet, setShowWallet] = useState(false);
  const [showDM, setShowDM] = useState(null);
  const [dmInput, setDmInput] = useState("");

  // Friends list with full data
  const friends = [
    { name: "Ate Rosa", avatar: "AR", rating: 4.7, sharedCircles: ["Bahay Fund"], role: "manager", vouchStatus: "she_vouched_you", vouchAmount: 500, lastActive: "Online now" },
    { name: "Kuya Ben", avatar: "KB", rating: 4.6, sharedCircles: ["Bahay Fund", "Educ Circle"], role: "member", vouchStatus: "you_vouched_them", vouchAmount: 0, lastActive: "2h ago" },
    { name: "Lisa M.", avatar: "LM", rating: 4.2, sharedCircles: ["Bahay Fund"], role: "member", vouchStatus: "you_vouched_them", vouchAmount: 500, lastActive: "1d ago" },
    { name: "Ana R.", avatar: "An", rating: 4.1, sharedCircles: ["Bahay Fund"], role: "member", vouchStatus: null, vouchAmount: 0, lastActive: "5h ago" },
  ];

  // Mock DM history
  const dmHistory = {
    "Ate Rosa": [
      { sender: "Ate Rosa", text: "Hi Maria! Thanks for being part of Bahay Fund ğŸ’š", time: "Yesterday" },
      { sender: "You", text: "Thank you po Ate! Happy to be here ğŸ™", time: "Yesterday" },
    ],
    "Kuya Ben": [
      { sender: "You", text: "Hey Ben, are you starting Educ Circle soon?", time: "2 days ago" },
      { sender: "Kuya Ben", text: "Yes! Just need 1 more member. Know anyone?", time: "2 days ago" },
    ],
  };

  // DM View
  if (showDM) {
    const friend = showDM;
    const messages = dmHistory[friend.name] || [];
    return (
      <div style={{ padding: "0 20px 20px", display: "flex", flexDirection: "column", height: "100%" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={() => { setShowDM(null); setDmInput(""); }} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
          <div style={{ width: 36, height: 36, borderRadius: "50%", background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 700, color: "#fff" }}>{friend.avatar}</div>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>{friend.name}</div>
            <div style={{ fontSize: 10, color: friend.lastActive === "Online now" ? "#00D65B" : "rgba(255,255,255,0.3)" }}>{friend.lastActive}</div>
          </div>
        </div>

        {/* Shared info */}
        <div style={{ padding: "10px 12px", background: "rgba(59,130,246,0.06)", borderRadius: 10, marginBottom: 12, display: "flex", gap: 6, flexWrap: "wrap", alignItems: "center" }}>
          <span style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Shared circles:</span>
          {friend.sharedCircles.map((c, i) => (
            <span key={i} style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(59,130,246,0.1)", color: "#60A5FA" }}>{c}</span>
          ))}
          {friend.vouchStatus && (
            <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 4, background: "rgba(245,158,11,0.1)", color: "#FBBF24" }}>
              {friend.vouchStatus === "you_vouched_them" ? "You vouched" : "Vouched for you"}
            </span>
          )}
        </div>

        {/* Messages */}
        <div style={{ flex: 1, overflowY: "auto", display: "flex", flexDirection: "column", gap: 8, marginBottom: 12, minHeight: 200 }}>
          {messages.length === 0 && (
            <div style={{ textAlign: "center", padding: "40px 20px", color: "rgba(255,255,255,0.2)" }}>
              <div style={{ fontSize: 24, marginBottom: 8 }}>ğŸ’¬</div>
              <div style={{ fontSize: 12 }}>Start a conversation with {friend.name}</div>
            </div>
          )}
          {messages.map((msg, i) => {
            const isMe = msg.sender === "You";
            return (
              <div key={i} style={{ display: "flex", flexDirection: isMe ? "row-reverse" : "row", gap: 8, alignItems: "flex-end" }}>
                {!isMe && <div style={{ width: 28, height: 28, borderRadius: "50%", flexShrink: 0, background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, fontWeight: 700, color: "#fff" }}>{friend.avatar}</div>}
                <div style={{ maxWidth: "75%", padding: "10px 14px", borderRadius: isMe ? "14px 14px 4px 14px" : "14px 14px 14px 4px", background: isMe ? "linear-gradient(135deg, #00B14F, #00D65B)" : "rgba(255,255,255,0.06)" }}>
                  <div style={{ fontSize: 12, color: isMe ? "#fff" : "rgba(255,255,255,0.7)", lineHeight: 1.4 }}>{msg.text}</div>
                  <div style={{ fontSize: 8, color: isMe ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.2)", marginTop: 3, textAlign: isMe ? "right" : "left" }}>{msg.time}</div>
                </div>
              </div>
            );
          })}
        </div>

        {/* Input */}
        <div style={{ display: "flex", gap: 8 }}>
          <input value={dmInput} onChange={(e) => setDmInput(e.target.value)} placeholder={`Message ${friend.name}...`}
            style={{ flex: 1, padding: "12px 16px", borderRadius: 24, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, outline: "none" }}
          />
          <button style={{ width: 44, height: 44, borderRadius: "50%", border: "none", background: "linear-gradient(135deg, #00B14F, #00D65B)", cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16, color: "#fff" }}>â†‘</button>
        </div>
      </div>
    );
  }

  return (
    <div style={{ padding: "0 20px 20px" }}>
      <div style={{ padding: "16px 0", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Settings</div>
        <Logo size={24} variant="icon" />
      </div>

      {/* Profile */}
      <div
        style={{
          background: "linear-gradient(145deg, #111827, #1A2332)",
          borderRadius: 16,
          padding: "20px",
          border: "1px solid rgba(255,255,255,0.06)",
          marginBottom: 16,
          display: "flex",
          alignItems: "center",
          gap: 16,
        }}
      >
        <div
          style={{
            width: 52,
            height: 52,
            borderRadius: "50%",
            background: "linear-gradient(135deg, #00B14F, #00D65B)",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            fontSize: 18,
            fontWeight: 700,
            color: "#fff",
          }}
        >
          {user.avatar}
        </div>
        <div>
          <div style={{ fontSize: 16, fontWeight: 700, color: "#fff" }}>{user.name}</div>
          <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)" }}>
            {REGIONS[region].flag} {REGIONS[region].name} Â· {REGIONS[region].currency}
          </div>
        </div>
      </div>

      {/* Region Selector */}
      <div style={{ marginBottom: 16 }}>
        <div style={{ fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.4)", marginBottom: 8, letterSpacing: 0.5 }}>
          REGION
        </div>
        <div style={{ display: "flex", gap: 8 }}>
          {Object.entries(REGIONS).map(([key, val]) => (
            <button
              key={key}
              onClick={() => onRegionChange(key)}
              style={{
                flex: 1,
                padding: "12px",
                borderRadius: 12,
                border: region === key ? "1px solid #00B14F" : "1px solid rgba(255,255,255,0.06)",
                background: region === key ? "rgba(0,177,79,0.1)" : "rgba(255,255,255,0.03)",
                color: region === key ? "#00D65B" : "rgba(255,255,255,0.5)",
                fontSize: 12,
                fontWeight: 600,
                cursor: "pointer",
                textAlign: "center",
              }}
            >
              <div style={{ fontSize: 20, marginBottom: 4 }}>{val.flag}</div>
              {key}
            </button>
          ))}
        </div>
      </div>

      {/* Advanced: Wallet */}
      <div
        style={{
          background: "linear-gradient(145deg, #111827, #1A2332)",
          borderRadius: 16,
          border: "1px solid rgba(255,255,255,0.06)",
          overflow: "hidden",
        }}
      >
        <button
          onClick={() => setShowWallet(!showWallet)}
          style={{
            width: "100%",
            display: "flex",
            justifyContent: "space-between",
            alignItems: "center",
            padding: "16px 20px",
            background: "none",
            border: "none",
            color: "#fff",
            cursor: "pointer",
          }}
        >
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            <span style={{ fontSize: 18 }}>ğŸ”</span>
            <span style={{ fontSize: 14, fontWeight: 600 }}>Advanced: Wallet Details</span>
          </div>
          <span style={{ color: "rgba(255,255,255,0.3)", transform: showWallet ? "rotate(90deg)" : "none", transition: "transform 0.2s" }}>
            â€º
          </span>
        </button>
        {showWallet && (
          <div style={{ padding: "0 20px 20px", borderTop: "1px solid rgba(255,255,255,0.04)" }}>
            <div style={{ paddingTop: 16 }}>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginBottom: 4, letterSpacing: 0.5 }}>
                BLOCKCHAIN AUDIT ADDRESS
              </div>
              <div
                style={{
                  padding: "10px 14px",
                  background: "rgba(255,255,255,0.04)",
                  borderRadius: 8,
                  fontFamily: "monospace",
                  fontSize: 13,
                  color: "#60A5FA",
                  marginBottom: 12,
                  wordBreak: "break-all",
                }}
              >
                {user.walletAddress}
              </div>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginBottom: 4, letterSpacing: 0.5 }}>
                NETWORK
              </div>
              <div style={{ fontSize: 13, color: "#fff", fontWeight: 600, marginBottom: 12 }}>
                Blockchain Audit Trail
              </div>
              <div style={{ padding: "10px 14px", background: "rgba(245,158,11,0.08)", borderRadius: 10, border: "1px solid rgba(245,158,11,0.15)" }}>
                <div style={{ fontSize: 11, color: "#F59E0B", fontWeight: 600 }}>
                  Every transaction is recorded on-chain for transparency. Your funds stay in GCash/Maya â€” the blockchain is the verification layer.
                </div>
              </div>
            </div>
          </div>
        )}
      </div>

      {/* â”€â”€â”€ Circle of Trust (Friends) â”€â”€â”€ */}
      <div style={{ marginTop: 16, marginBottom: 16 }}>
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 }}>
          <div>
            <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>Circle of Trust</div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>{friends.length} friends across your circles</div>
          </div>
          <span style={{ fontSize: 10, padding: "4px 10px", borderRadius: 8, background: "rgba(59,130,246,0.1)", color: "#60A5FA", fontWeight: 600 }}>
            {friends.filter(f => f.vouchStatus).length} vouch connections
          </span>
        </div>

        {friends.map((f, i) => (
          <div key={i} style={{
            background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 14, padding: "14px 16px", marginBottom: 6,
            border: "1px solid rgba(255,255,255,0.05)", display: "flex", alignItems: "center", gap: 12,
          }}>
            {/* Avatar + Online */}
            <div style={{ position: "relative" }}>
              <div style={{ width: 42, height: 42, borderRadius: "50%", background: f.role === "manager" ? "linear-gradient(135deg, #A855F7, #7C3AED)" : "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 700, color: "#fff" }}>{f.avatar}</div>
              {f.lastActive === "Online now" && (
                <span style={{ position: "absolute", bottom: 0, right: 0, width: 10, height: 10, borderRadius: "50%", background: "#00D65B", border: "2px solid #111827" }} />
              )}
            </div>

            {/* Info */}
            <div style={{ flex: 1 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <span style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>{f.name}</span>
                {f.role === "manager" && <span style={{ fontSize: 7, padding: "1px 4px", borderRadius: 3, background: "rgba(168,85,247,0.15)", color: "#A855F7", fontWeight: 700 }}>MGR</span>}
                <span style={{ fontSize: 9, color: "rgba(255,255,255,0.25)" }}>{f.rating}â˜…</span>
              </div>
              <div style={{ display: "flex", gap: 4, marginTop: 4, flexWrap: "wrap" }}>
                {f.sharedCircles.map((c, j) => (
                  <span key={j} style={{ fontSize: 8, padding: "2px 5px", borderRadius: 3, background: "rgba(255,255,255,0.05)", color: "rgba(255,255,255,0.35)" }}>{c}</span>
                ))}
                {f.vouchStatus === "you_vouched_them" && f.vouchAmount > 0 && (
                  <span style={{ fontSize: 8, padding: "2px 5px", borderRadius: 3, background: "rgba(245,158,11,0.1)", color: "#FBBF24" }}>
                    You staked â‚±{f.vouchAmount}
                  </span>
                )}
                {f.vouchStatus === "she_vouched_you" && (
                  <span style={{ fontSize: 8, padding: "2px 5px", borderRadius: 3, background: "rgba(0,177,79,0.1)", color: "#00D65B" }}>
                    Vouched for you
                  </span>
                )}
              </div>
            </div>

            {/* Actions */}
            <div style={{ display: "flex", gap: 6 }}>
              <button onClick={() => setShowDM(f)} style={{ padding: "6px 12px", borderRadius: 8, border: "none", background: "rgba(59,130,246,0.1)", color: "#60A5FA", fontSize: 10, fontWeight: 600, cursor: "pointer" }}>
                ğŸ’¬ DM
              </button>
            </div>
          </div>
        ))}

        {/* Trust Stats */}
        <div style={{ marginTop: 10, padding: "14px", background: "rgba(59,130,246,0.04)", borderRadius: 12, border: "1px solid rgba(59,130,246,0.08)" }}>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8 }}>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 18, fontWeight: 800, color: "#60A5FA" }}>{friends.length}</div>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Friends</div>
            </div>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 18, fontWeight: 800, color: "#FBBF24" }}>{friends.filter(f => f.vouchStatus).length}</div>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Vouch Links</div>
            </div>
            <div style={{ textAlign: "center" }}>
              <div style={{ fontSize: 18, fontWeight: 800, color: "#00D65B" }}>{new Set(friends.flatMap(f => f.sharedCircles)).size}</div>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>Shared Circles</div>
            </div>
          </div>
        </div>
      </div>

      {/* Schema Reference */}
      <div style={{ marginTop: 24 }}>
        <div style={{ fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.3)", marginBottom: 8, letterSpacing: 0.5 }}>
          DEV: SUPABASE SCHEMA
        </div>
        {Object.entries(SUPABASE_SCHEMA).map(([table, sql]) => (
          <details key={table} style={{ marginBottom: 6 }}>
            <summary
              style={{
                padding: "10px 14px",
                background: "rgba(255,255,255,0.03)",
                borderRadius: 10,
                fontSize: 12,
                color: "rgba(255,255,255,0.5)",
                cursor: "pointer",
                fontFamily: "monospace",
              }}
            >
              {table}
            </summary>
            <pre
              style={{
                padding: "12px",
                background: "rgba(0,0,0,0.3)",
                borderRadius: "0 0 10px 10px",
                fontSize: 10,
                color: "rgba(255,255,255,0.4)",
                overflow: "auto",
                margin: 0,
                lineHeight: 1.5,
              }}
            >
              {sql.trim()}
            </pre>
          </details>
        ))}
      </div>

      {/* Brand Identity Section */}
      <div style={{ marginTop: 24 }}>
        <div style={{ fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.3)", marginBottom: 12, letterSpacing: 0.5 }}>
          BRAND ASSETS (PLACEHOLDERS)
        </div>
        <div style={{
          background: "linear-gradient(145deg, #111827, #1A2332)",
          borderRadius: 16,
          padding: "20px",
          border: "1px solid rgba(255,255,255,0.06)",
          marginBottom: 12,
        }}>
          <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginBottom: 14, fontWeight: 600 }}>
            LOGO VARIANTS
          </div>
          <div style={{ marginBottom: 16, padding: "16px", background: "rgba(0,0,0,0.2)", borderRadius: 12 }}>
            <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", marginBottom: 8, letterSpacing: 1 }}>FULL (HEADER)</div>
            <Logo size={32} variant="full" />
          </div>
          <div style={{ display: "flex", gap: 12, marginBottom: 16 }}>
            <div style={{ flex: 1, padding: "16px", background: "rgba(0,0,0,0.2)", borderRadius: 12, textAlign: "center" }}>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", marginBottom: 8, letterSpacing: 1 }}>ICON</div>
              <div style={{ display: "flex", justifyContent: "center" }}><Logo size={36} variant="icon" /></div>
            </div>
            <div style={{ flex: 1, padding: "16px", background: "rgba(0,0,0,0.2)", borderRadius: 12, textAlign: "center" }}>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", marginBottom: 8, letterSpacing: 1 }}>WORDMARK</div>
              <div style={{ display: "flex", justifyContent: "center" }}><Logo size={32} variant="wordmark" /></div>
            </div>
          </div>
          <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", marginBottom: 8, letterSpacing: 1 }}>DROP-IN IMAGE PLACEHOLDER</div>
          <LogoImagePlaceholder width="100%" height={60} label="Drop your logo PNG/SVG here" />
          <div style={{ marginTop: 12, padding: "16px", background: "#f0f0f0", borderRadius: 12, textAlign: "center" }}>
            <div style={{ fontSize: 9, color: "rgba(0,0,0,0.35)", marginBottom: 8, letterSpacing: 1 }}>ON LIGHT BG</div>
            <Logo size={28} variant="full" color="#0A0E17" />
          </div>
        </div>
      </div>

      {/* App Footer */}
      <div style={{ textAlign: "center", padding: "24px 0 8px", borderTop: "1px solid rgba(255,255,255,0.04)", marginTop: 16 }}>
        <div style={{ display: "flex", justifyContent: "center", marginBottom: 8 }}>
          <Logo size={20} variant="icon" />
        </div>
        <div style={{ fontSize: 11, color: "rgba(255,255,255,0.25)", fontWeight: 600 }}>{APP_NAME}</div>
        <div style={{ fontSize: 10, color: "rgba(255,255,255,0.15)", marginTop: 2 }}>v1.0.0 Â· Philippines ğŸ‡µğŸ‡­ Â· Blockchain-verified</div>
      </div>
    </div>
  );
}

// â”€â”€â”€ Circles Screen (Geography-Based with Ratings & Approval) â”€â”€â”€â”€
function CirclesScreen({ region, user }) {
  const r = REGIONS[region];
  const [tab, setTab] = useState("my"); // my | discover | pending | vouch
  const [selectedCircle, setSelectedCircle] = useState(null);
  const [applyingTo, setApplyingTo] = useState(null);
  const [applicationNote, setApplicationNote] = useState("");
  const [showCreateFlow, setShowCreateFlow] = useState(false);
  const [activeCircleView, setActiveCircleView] = useState(null); // for My Circles detail
  const [circleTab, setCircleTab] = useState("overview"); // overview | members | chat
  const [chatMessages, setChatMessages] = useState([]);
  const [chatInput, setChatInput] = useState("");
  const [friendsList, setFriendsList] = useState(["Ate Rosa", "Kuya Ben"]);

  // Mock chat messages per circle
  const mockChats = {
    "c1": [
      { id: 1, sender: "Ate Rosa", avatar: "AR", text: "Reminder: contributions due this Friday!", time: "10:30 AM", isManager: true },
      { id: 2, sender: "Kuya Ben", avatar: "KB", text: "Paid na po! ğŸ™", time: "10:45 AM" },
      { id: 3, sender: "You", avatar: "MS", text: "Done paying too! Receipt sent.", time: "11:02 AM", isMe: true },
      { id: 4, sender: "Lisa M.", avatar: "LM", text: "Will pay tonight after work", time: "12:15 PM" },
      { id: 5, sender: "Ate Rosa", avatar: "AR", text: "Thanks everyone! 7 of 10 paid so far ğŸ’š", time: "2:00 PM", isManager: true },
    ],
    "c2": [
      { id: 1, sender: "Kuya Ben", avatar: "KB", text: "Welcome to Educ Circle! We need 1 more member to start.", time: "9:00 AM", isManager: true },
      { id: 2, sender: "You", avatar: "MS", text: "Excited to join! When do we start?", time: "9:15 AM", isMe: true },
    ],
  };

  // Mock full member data for circle detail
  const mockCircleMembers = {
    "c1": [
      { name: "Ate Rosa", avatar: "AR", role: "manager", rating: 4.7, status: "paid", position: 1, joinedVia: "founder" },
      { name: "Maria Santos", avatar: "MS", role: "member", rating: 4.4, status: "paid", position: 7, joinedVia: "direct", isMe: true },
      { name: "Kuya Ben", avatar: "KB", role: "member", rating: 4.6, status: "paid", position: 3, joinedVia: "direct" },
      { name: "Lisa M.", avatar: "LM", role: "member", rating: 4.2, status: "paid", position: 4, joinedVia: "vouched", vouchedBy: "Maria Santos" },
      { name: "Juan D.", avatar: "JC", role: "member", rating: 3.5, status: "late", position: 5, joinedVia: "vouched", vouchedBy: "Maria Santos", lateBy: "2 days" },
      { name: "Ana R.", avatar: "An", role: "member", rating: 4.1, status: "paid", position: 6, joinedVia: "direct" },
      { name: "Rico P.", avatar: "RP", role: "member", rating: 4.3, status: "paid", position: 2, joinedVia: "direct" },
      { name: "Grace L.", avatar: "GL", role: "member", rating: 3.9, status: "delinquent", position: 8, joinedVia: "vouched", vouchedBy: "Kuya Ben", lateBy: "5 days", missedPayments: 1 },
      { name: "Mark T.", avatar: "MT", role: "member", rating: 4.5, status: "paid", position: 9, joinedVia: "direct" },
      { name: "Nina C.", avatar: "NC", role: "member", rating: 4.0, status: "pending", position: 10, joinedVia: "vouched", vouchedBy: "Ana R." },
    ],
    "c2": [
      { name: "Kuya Ben", avatar: "KB", role: "manager", rating: 4.6, status: "paid", position: 1, joinedVia: "founder" },
      { name: "Maria Santos", avatar: "MS", role: "member", rating: 4.4, status: "due", position: 2, joinedVia: "direct", isMe: true },
      { name: "Tina V.", avatar: "TV", role: "member", rating: 4.0, status: "paid", position: 3, joinedVia: "vouched", vouchedBy: "Kuya Ben" },
      { name: "Empty Slot", avatar: "??", role: "empty", status: "waiting", position: 4 },
    ],
  };
  const [createStep, setCreateStep] = useState("eligibility");
  // â”€â”€â”€ Smart Vouch State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [showInvite, setShowInvite] = useState(false);
  const [inviteStep, setInviteStep] = useState("search"); // search | risk | confirm | sent
  const [inviteEmail, setInviteEmail] = useState("");
  const [inviteCircle, setInviteCircle] = useState(null);
  const [inviteeData, setInviteeData] = useState(null);
  const [bondConfirmed, setBondConfirmed] = useState(false);

  // Mock invitee lookup results
  const lookupInvitee = (email) => {
    const mockUsers = {
      "juan@email.com": { name: "Juan Dela Cruz", avatar: "JC", isNew: true, rating: null, completedCircles: 0, bondRequired: true, bondPercent: 50 },
      "ana@email.com": { name: "Ana Reyes", avatar: "AR", isNew: false, rating: 3.6, completedCircles: 4, bondRequired: true, bondPercent: 50 },
      "rick@email.com": { name: "Rick Morales", avatar: "RM", isNew: false, rating: 4.5, completedCircles: 8, bondRequired: false, bondPercent: 0 },
    };
    return mockUsers[email] || { name: email.split("@")[0], avatar: "??", isNew: true, rating: null, completedCircles: 0, bondRequired: true, bondPercent: 50 };
  };

  // Active bonds â€” two sides of the ledger
  const bondsAsVoucher = [
    { id: "b1", guaranteedUser: "Juan D.", avatar: "JC", circle: "Bahay Fund", amount: 500, status: "active", monthsCompleted: 2, monthsRequired: 5 },
    { id: "b2", guaranteedUser: "Lisa M.", avatar: "LM", circle: "Educ Circle", amount: 1000, status: "released", monthsCompleted: 5, monthsRequired: 5 },
  ];
  const bondsAsVouchee = [
    { id: "b3", voucher: "Ate Rosa", avatar: "AR", circle: "Bahay Fund", amount: 500, status: "released", monthsCompleted: 5, monthsRequired: 5 },
  ];
  const activeBonds = bondsAsVoucher; // for tab badge count

  const [managerApp, setManagerApp] = useState({
    circleName: "",
    description: "",
    monthlyContribution: "",
    maxMembers: "10",
    totalRounds: "10",
    location: "Manila, PH",
    minRating: "3.5",
    requiresVote: true,
    idUploaded: false,
    proofUploaded: false,
    bankLinked: false,
    bankName: "",
    bankAccountLast4: "",
    reason: "",
    managerFeePercent: "1.5", // locked to level
  });
  const [managerAppSubmitted, setManagerAppSubmitted] = useState(false);

  // â”€â”€â”€ Manager Level Tiers (Career Path) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const MANAGER_LEVELS = [
    {
      level: 1,
      title: "Rookie",
      subtitle: "Trial Phase",
      emoji: "ğŸŒ±",
      color: "#00B14F",
      feePercent: 1.5,
      totalFee: 3.5,  // platform + manager
      maxCircles: 3,
      maxTotalMembers: 30,
      maxMembersPerCircle: 10,
      securityDeposit: 5000,  // fixed â‚±5,000
      entryRequirements: [
        "ID Verification (Gov't ID + Selfie)",
        "Phone Interview with Company",
        '"Coffee Test" â€” Meet 3 existing members in person',
      ],
      promotionGoal: "Prove you can collect money on time",
      // Income projection (assuming â‚±20,000 pot)
      monthlyIncome: 900,   // 3 circles Ã— â‚±20K Ã— 1.5%
      annualIncome: 10800,
    },
    {
      level: 2,
      title: "Captain",
      subtitle: "Established",
      emoji: "â­",
      color: "#FBBF24",
      feePercent: 2.0,
      totalFee: 4.0,
      maxCircles: 10,
      maxTotalMembers: 100,
      maxMembersPerCircle: 10,
      securityDeposit: 10000,  // â‚±10,000
      promotionCriteria: [
        "Complete 3 full cycles as Level 1",
        "0 defaults (clean sheet)",
        "Average 4.5â˜… rating from members",
      ],
      promotionGoal: "Build a reputation for reliability",
      monthlyIncome: 4000,
      annualIncome: 48000,
    },
    {
      level: 3,
      title: "Banker",
      subtitle: "Elite Partner",
      emoji: "ğŸ‘‘",
      color: "#A855F7",
      feePercent: 3.0,
      totalFee: 5.0,
      maxCircles: 20,
      maxTotalMembers: 200,
      maxMembersPerCircle: 10,
      securityDeposit: 20000,  // â‚±20,000
      promotionCriteria: [
        "Manage â‚±2.5M+ in total volume",
        "Average 4.8â˜… rating from members",
        "Hold â‚±20,000 security deposit",
        "Company review & approval",
      ],
      promotionGoal: "Become a trusted financial partner in your community",
      monthlyIncome: 12000,
      annualIncome: 144000,
    },
  ];

  const PLATFORM_FEE = 2.0; // fixed 2% â†’ company (tech/security)

  // â”€â”€â”€ Demotion Rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DEMOTION_RULES = {
    ratingThreshold: 4.0,  // below this = auto-demote
    maxDefaultsBeforeBan: 2,
    reviewTriggers: [
      { event: "after_payout", question: "How fast did the Manager approve your withdrawal?" },
      { event: "end_of_circle", question: "Did the Manager communicate well?" },
    ],
    ratingGuide: [
      { stars: 5, label: "Perfect", desc: "Everything on time, great communication" },
      { stars: 4, label: "Good", desc: "Minor delays but reliable" },
      { stars: 3, label: "Okay", desc: "Late replies, confusing instructions" },
      { stars: 2, label: "Poor", desc: "Multiple delays, hard to reach" },
      { stars: 1, label: "Bad", desc: "Rude, abusive, or suspicious behavior" },
    ],
  };

  // â”€â”€â”€ Member Eligibility (to become a manager) â”€â”€
  const MANAGER_REQUIREMENTS = {
    minCompletedCircles: 10,
    minAvgRating: 4.3,
    requiresKYC: true,
    requiresBankAccount: true,
    requiresSecurityDeposit: true,
    requiresCompanyApproval: true,
    requiresPhoneInterview: true,
    requiresCoffeeTest: true,
  };

  // User's current stats
  const userStats = {
    completedCircles: 12,
    avgRating: 4.4,
    totalContributed: 156000,
    onTimePayments: 118,
    latePayments: 2,
    missedPayments: 0,
    memberSince: "2024-06-15",
    kycVerified: true,
    bankVerified: true,
    bankName: "BDO Unibank",
    bankLast4: "4532",
    walletBalance: 15000,
    // Manager-specific
    circlesManagedCompleted: 0,
    activeCirclesManaged: 0,
    totalVolumeManaged: 0,
    managerDefaults: 0,
    managerRating: null,
    managerReviewCount: 0,
    coffeeTestCompleted: false,
    phoneInterviewCompleted: false,
  };

  // Determine current manager level
  const getCurrentManagerLevel = () => {
    const s = userStats;
    const rating = s.managerRating || s.avgRating;
    // Check for demotion first
    if (s.managerRating && s.managerRating < DEMOTION_RULES.ratingThreshold) {
      return MANAGER_LEVELS[0]; // demoted to Rookie
    }
    if (s.totalVolumeManaged >= 2500000 && rating >= 4.8 && s.walletBalance >= 20000) return MANAGER_LEVELS[2];
    if (s.circlesManagedCompleted >= 3 && rating >= 4.5 && s.managerDefaults === 0) return MANAGER_LEVELS[1];
    return MANAGER_LEVELS[0];
  };

  const currentLevel = getCurrentManagerLevel();
  const nextLevel = currentLevel.level < 3 ? MANAGER_LEVELS[currentLevel.level] : null;
  const circlesRemaining = currentLevel.maxCircles - userStats.activeCirclesManaged;
  const isDemotionRisk = userStats.managerRating && userStats.managerRating < 4.2 && userStats.managerRating >= 4.0;

  // Compute security deposit (fixed per level)
  const computeSecurityDeposit = () => currentLevel.securityDeposit;

  // Compute earnings (fee locked to level)
  const computeManagerEarnings = () => {
    const contribution = Number(managerApp.monthlyContribution) || 0;
    const members = Number(managerApp.maxMembers) || 10;
    const rounds = Number(managerApp.totalRounds) || 10;
    const potPerRound = contribution * members;
    const perRound = potPerRound * (currentLevel.feePercent / 100);
    const total = perRound * rounds;
    const platformPerRound = potPerRound * (PLATFORM_FEE / 100);
    // At max capacity for this level
    const maxMonthly = currentLevel.monthlyIncome;
    const maxAnnual = currentLevel.annualIncome;
    return { perRound, total, potPerRound, platformPerRound, maxMonthly, maxAnnual };
  };

  // User rating system (1-5 stars based on history)
  const userRating = userStats.avgRating;
  const renderStars = (rating, size = 10) => {
    const full = Math.floor(rating);
    const half = rating % 1 >= 0.5;
    return (
      <div style={{ display: "flex", alignItems: "center", gap: 1 }}>
        {[...Array(5)].map((_, i) => (
          <span key={i} style={{ fontSize: size, color: i < full ? "#FBBF24" : (i === full && half) ? "#FBBF24" : "rgba(255,255,255,0.15)" }}>
            {i < full ? "â˜…" : (i === full && half) ? "â˜…" : "â˜†"}
          </span>
        ))}
        <span style={{ fontSize: size - 1, color: "rgba(255,255,255,0.4)", marginLeft: 4, fontWeight: 600 }}>{rating}</span>
      </div>
    );
  };

  // My circles
  const myCircles = [
    {
      id: "c1", name: "Bahay Fund", emoji: "ğŸ ", location: "Manila, PH", distance: "2 km",
      members: 10, maxMembers: 10, monthlyContribution: 1000, currentRound: 3, totalRounds: 10,
      status: "active", manager: { name: "Ate Rosa", avatar: "AR", rating: 4.8, verified: true },
      minRating: 3.5, requiresVote: false,
    },
    {
      id: "c2", name: "Educ Circle", emoji: "ğŸ“š", location: "Quezon City, PH", distance: "8 km",
      members: 4, maxMembers: 5, monthlyContribution: 2000, currentRound: 1, totalRounds: 5,
      status: "forming", manager: { name: "Kuya Ben", avatar: "KB", rating: 4.5, verified: true },
      minRating: 4.0, requiresVote: true,
    },
  ];

  // Discover circles (geography-based, near user)
  const discoverCircles = [
    {
      id: "d1", name: "Tondo Savers", emoji: "ğŸ’ª", location: "Tondo, Manila", distance: "3 km",
      members: 7, maxMembers: 10, monthlyContribution: 500, currentRound: 2, totalRounds: 10,
      status: "active", manager: { name: "Mang Eddie", avatar: "ME", rating: 4.6, verified: true },
      minRating: 3.0, requiresVote: false, spotsLeft: 3,
    },
    {
      id: "d2", name: "Makati Hustle", emoji: "ğŸ¢", location: "Makati City", distance: "12 km",
      members: 8, maxMembers: 10, monthlyContribution: 5000, currentRound: 0, totalRounds: 10,
      status: "forming", manager: { name: "Jess T.", avatar: "JT", rating: 4.9, verified: true },
      minRating: 4.5, requiresVote: true, spotsLeft: 2,
    },
    {
      id: "d3", name: "Pasig River Circle", emoji: "ğŸŒŠ", location: "Pasig City", distance: "15 km",
      members: 5, maxMembers: 8, monthlyContribution: 1500, currentRound: 1, totalRounds: 8,
      status: "active", manager: { name: "Tita May", avatar: "TM", rating: 4.3, verified: false },
      minRating: 3.5, requiresVote: true, spotsLeft: 3,
    },
    {
      id: "d4", name: "BGC Elite", emoji: "â­", location: "Bonifacio Global City", distance: "14 km",
      members: 9, maxMembers: 10, monthlyContribution: 10000, currentRound: 5, totalRounds: 10,
      status: "active", manager: { name: "Paolo R.", avatar: "PR", rating: 5.0, verified: true },
      minRating: 4.8, requiresVote: true, spotsLeft: 1,
    },
  ];

  // Pending approvals (for circles you manage or are a member of)
  const meetsRating = (minRating) => userRating >= minRating;

  // â”€â”€â”€ Active Circle Dashboard (My Circles detail) â”€â”€â”€â”€â”€
  if (activeCircleView) {
    const ac = activeCircleView;
    const members = mockCircleMembers[ac.id] || [];
    const messages = mockChats[ac.id] || [];
    const paidCount = members.filter(m => m.status === "paid").length;
    const lateMembers = members.filter(m => m.status === "late" || m.status === "delinquent");
    const activeMemberCount = members.filter(m => m.role !== "empty").length;
    const totalPot = ac.monthlyContribution * activeMemberCount;
    const roundsLeft = ac.totalRounds - ac.currentRound;
    const weeksLeft = roundsLeft * 4;
    const nextPayoutMember = members.find(m => m.position === ac.currentRound + 1);
    const isFriend = (name) => friendsList.includes(name);

    // Dividend calculation from bid discounts
    // Last round's winning bid discount gets split among non-winning members
    const lastWinningDiscount = ac.id === "c1" ? 300 : 0; // Kuya Ben bid â‚±300 in R3
    const dividendPerMember = lastWinningDiscount > 0 ? Math.floor(lastWinningDiscount / (activeMemberCount - 1)) : 0;
    const yourContribution = ac.monthlyContribution;
    const youOweAfterDividend = yourContribution - dividendPerMember;
    const hasDividend = dividendPerMember > 0;
    const myMember = members.find(m => m.isMe);
    const isPaid = myMember?.status === "paid";
    const dueDate = ac.id === "c1" ? "Mar 1, 2026" : "Feb 20, 2026";
    const daysUntilDue = ac.id === "c1" ? 12 : 3;

    return (
      <div style={{ padding: "0 20px 20px" }}>
        {/* Header */}
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={() => { setActiveCircleView(null); setCircleTab("overview"); }} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
          <div style={{ flex: 1 }}>
            <div style={{ fontSize: 16, fontWeight: 700, color: "#fff", display: "flex", alignItems: "center", gap: 8 }}>
              {ac.emoji} {ac.name}
              <span style={{ fontSize: 8, padding: "2px 6px", borderRadius: 4, background: ac.status === "active" ? "rgba(0,177,79,0.15)" : "rgba(245,158,11,0.15)", color: ac.status === "active" ? "#00D65B" : "#F59E0B", fontWeight: 700 }}>
                {ac.status === "active" ? "ACTIVE" : "FORMING"}
              </span>
            </div>
          </div>
          <Logo size={24} variant="icon" />
        </div>

        {/* Sub-tabs */}
        <div style={{ display: "flex", gap: 4, marginBottom: 16, background: "rgba(255,255,255,0.04)", borderRadius: 10, padding: 3 }}>
          {["overview", "members", "chat"].map((t) => (
            <button key={t} onClick={() => setCircleTab(t)} style={{
              flex: 1, padding: "8px 0", borderRadius: 8, border: "none", fontSize: 11, fontWeight: 600, cursor: "pointer",
              background: circleTab === t ? "rgba(0,177,79,0.15)" : "transparent",
              color: circleTab === t ? "#00D65B" : "rgba(255,255,255,0.4)",
            }}>
              {t === "overview" ? "ğŸ“Š Overview" : t === "members" ? `ğŸ‘¥ Members (${members.filter(m=>m.role!=="empty").length})` : `ğŸ’¬ Chat`}
            </button>
          ))}
        </div>

        {/* â”€â”€â”€ OVERVIEW TAB â”€â”€â”€ */}
        {circleTab === "overview" && (
          <div>
            {/* â”€â”€â”€ Payment & Dividend Card â”€â”€â”€ */}
            <div style={{
              background: isPaid ? "linear-gradient(145deg, #0A1628, #111827)" : "linear-gradient(145deg, #1A1508, #1A1200)",
              borderRadius: 16, padding: "20px", marginBottom: 12,
              border: isPaid ? "1px solid rgba(0,177,79,0.15)" : "1px solid rgba(245,158,11,0.2)",
            }}>
              {/* Status Header */}
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                  <span style={{ width: 10, height: 10, borderRadius: "50%", background: isPaid ? "#00D65B" : "#F59E0B", boxShadow: isPaid ? "none" : "0 0 8px rgba(245,158,11,0.4)" }} />
                  <span style={{ fontSize: 13, fontWeight: 700, color: isPaid ? "#00D65B" : "#FBBF24" }}>
                    {isPaid ? "Paid This Round âœ“" : "Payment Due"}
                  </span>
                </div>
                <div style={{ fontSize: 11, color: isPaid ? "rgba(255,255,255,0.3)" : daysUntilDue <= 3 ? "#EF4444" : "#FBBF24", fontWeight: 600 }}>
                  {isPaid ? "Next due: " + dueDate : daysUntilDue <= 3 ? `âš  ${daysUntilDue} days left` : `Due: ${dueDate}`}
                </div>
              </div>

              {/* Amount Breakdown */}
              <div style={{ padding: "14px", background: "rgba(0,0,0,0.2)", borderRadius: 12, marginBottom: 14 }}>
                <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, marginBottom: 6 }}>
                  <span style={{ color: "rgba(255,255,255,0.45)" }}>Monthly Contribution</span>
                  <span style={{ color: "#fff", fontWeight: 600 }}>{formatCurrency(yourContribution, r.symbol)}</span>
                </div>
                {hasDividend && (
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, marginBottom: 6 }}>
                    <span style={{ color: "#00D65B" }}>ğŸ Dividend (from Round {ac.currentRound} bid)</span>
                    <span style={{ color: "#00D65B", fontWeight: 700 }}>-{formatCurrency(dividendPerMember, r.symbol)}</span>
                  </div>
                )}
                <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "8px 0" }} />
                <div style={{ display: "flex", justifyContent: "space-between", fontSize: 14 }}>
                  <span style={{ color: "#fff", fontWeight: 700 }}>You Owe</span>
                  <span style={{ fontSize: 18, fontWeight: 800, color: hasDividend ? "#00D65B" : "#fff" }}>
                    {formatCurrency(youOweAfterDividend, r.symbol)}
                  </span>
                </div>
                {hasDividend && (
                  <div style={{ fontSize: 10, color: "#00D65B", marginTop: 4, textAlign: "right" }}>
                    You saved {formatCurrency(dividendPerMember, r.symbol)} thanks to Kuya Ben's winning bid!
                  </div>
                )}
              </div>

              {/* Dividend Explanation (if applicable) */}
              {hasDividend && (
                <div style={{ padding: "10px 12px", background: "rgba(0,177,79,0.06)", borderRadius: 8, marginBottom: 14, fontSize: 10, color: "rgba(255,255,255,0.45)", lineHeight: 1.5 }}>
                  <strong style={{ color: "#00D65B" }}>How dividends work:</strong> Last round, Kuya Ben won the pot with a {formatCurrency(lastWinningDiscount, r.symbol)} discount. That {formatCurrency(lastWinningDiscount, r.symbol)} is split among {activeMemberCount - 1} members = <strong style={{ color: "#00D65B" }}>{formatCurrency(dividendPerMember, r.symbol)} off</strong> your contribution this round.
                </div>
              )}

              {/* Pay Now Button */}
              {!isPaid ? (
                <button style={{
                  width: "100%", padding: "16px", borderRadius: 14, border: "none",
                  background: "linear-gradient(135deg, #F59E0B, #D97706)", color: "#fff", fontSize: 15, fontWeight: 700,
                  cursor: "pointer", boxShadow: "0 4px 20px rgba(245,158,11,0.3)",
                  display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                }}>
                  ğŸ’³ Pay {formatCurrency(youOweAfterDividend, r.symbol)} Now
                </button>
              ) : (
                <div style={{ textAlign: "center", padding: "10px", fontSize: 11, color: "rgba(255,255,255,0.3)" }}>
                  âœ“ Payment received Â· Next round opens {dueDate}
                </div>
              )}
            </div>

            {/* Pot & Progress Card */}
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "20px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 12 }}>
              <div style={{ textAlign: "center", marginBottom: 16 }}>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 600, letterSpacing: 0.5 }}>CURRENT POT</div>
                <div style={{ fontSize: 28, fontWeight: 800, color: "#00D65B", marginTop: 4 }}>{formatCurrency(totalPot, r.symbol)}</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>ğŸ”— All transactions blockchain-verified</div>
              </div>

              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8, marginBottom: 16 }}>
                {[
                  { label: "Round", value: `${ac.currentRound}/${ac.totalRounds}`, color: "#fff" },
                  { label: "Time Left", value: `${roundsLeft} mo (${weeksLeft}w)`, color: "#FBBF24" },
                  { label: "Monthly", value: formatCurrency(ac.monthlyContribution, r.symbol), color: "#00D65B" },
                ].map((s, i) => (
                  <div key={i} style={{ textAlign: "center", padding: "10px 6px", background: "rgba(255,255,255,0.03)", borderRadius: 8 }}>
                    <div style={{ fontSize: 14, fontWeight: 800, color: s.color }}>{s.value}</div>
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>{s.label}</div>
                  </div>
                ))}
              </div>

              {/* Progress */}
              <div style={{ display: "flex", justifyContent: "space-between", fontSize: 10, color: "rgba(255,255,255,0.35)", marginBottom: 4 }}>
                <span>Progress</span>
                <span>{Math.round((ac.currentRound / ac.totalRounds) * 100)}%</span>
              </div>
              <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 6, height: 6 }}>
                <div style={{ width: `${(ac.currentRound / ac.totalRounds) * 100}%`, height: "100%", borderRadius: 6, background: "linear-gradient(90deg, #00B14F, #00D65B)" }} />
              </div>
            </div>

            {/* Collection Status */}
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 12 }}>
              <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", marginBottom: 12, letterSpacing: 0.5 }}>THIS ROUND'S COLLECTION</div>
              <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
                <span style={{ fontSize: 13, color: "#00D65B", fontWeight: 700 }}>{paidCount} paid</span>
                <span style={{ fontSize: 13, color: lateMembers.length > 0 ? "#EF4444" : "rgba(255,255,255,0.3)", fontWeight: 700 }}>
                  {lateMembers.length > 0 ? `${lateMembers.length} late/delinquent` : "All on track"}
                </span>
              </div>
              <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 4, height: 6, overflow: "hidden" }}>
                <div style={{ width: `${(paidCount / members.filter(m=>m.role!=="empty").length) * 100}%`, height: "100%", borderRadius: 4, background: "linear-gradient(90deg, #00B14F, #00D65B)" }} />
              </div>

              {/* Delinquent members alert */}
              {lateMembers.length > 0 && (
                <div style={{ marginTop: 12 }}>
                  {lateMembers.map((m, i) => (
                    <div key={i} style={{ display: "flex", alignItems: "center", gap: 10, padding: "8px 10px", background: m.status === "delinquent" ? "rgba(239,68,68,0.08)" : "rgba(245,158,11,0.06)", borderRadius: 8, marginBottom: 4, border: m.status === "delinquent" ? "1px solid rgba(239,68,68,0.12)" : "1px solid rgba(245,158,11,0.1)" }}>
                      <div style={{ width: 28, height: 28, borderRadius: "50%", background: m.status === "delinquent" ? "rgba(239,68,68,0.15)" : "rgba(245,158,11,0.15)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 700, color: "#fff" }}>{m.avatar}</div>
                      <div style={{ flex: 1 }}>
                        <div style={{ fontSize: 11, fontWeight: 700, color: "#fff" }}>{m.name}</div>
                        <div style={{ fontSize: 9, color: m.status === "delinquent" ? "#EF4444" : "#F59E0B" }}>
                          {m.status === "delinquent" ? `âš  Delinquent â€” ${m.lateBy} late Â· ${m.missedPayments} missed` : `â° Late by ${m.lateBy}`}
                        </div>
                      </div>
                      {m.vouchedBy && (
                        <span style={{ fontSize: 8, padding: "2px 6px", borderRadius: 4, background: "rgba(245,158,11,0.1)", color: "#FBBF24" }}>
                          Vouched by {m.vouchedBy}
                        </span>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Next Payout */}
            <div style={{ background: "linear-gradient(145deg, #0A1628, #111827)", borderRadius: 16, padding: "18px", border: "1px solid rgba(0,177,79,0.12)", marginBottom: 12 }}>
              <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", marginBottom: 10, letterSpacing: 0.5 }}>NEXT PAYOUT</div>
              <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                <div style={{ width: 44, height: 44, borderRadius: "50%", background: "linear-gradient(135deg, #00B14F, #00D65B)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 14, fontWeight: 700, color: "#fff" }}>
                  {nextPayoutMember ? nextPayoutMember.avatar : "?"}
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>
                    {nextPayoutMember ? `${nextPayoutMember.name} (#${nextPayoutMember.position})` : "TBD"}
                  </div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>
                    Receives {formatCurrency(totalPot * (1 - (ac.totalFee || 3.5) / 100), r.symbol)} after fees
                  </div>
                </div>
                <div style={{ fontSize: 12, color: "#00D65B", fontWeight: 700 }}>
                  Round {ac.currentRound + 1}
                </div>
              </div>
            </div>

            {/* Your Position */}
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(59,130,246,0.1)", marginBottom: 12 }}>
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                <div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>Your Position</div>
                  <div style={{ fontSize: 22, fontWeight: 800, color: "#60A5FA" }}>#{members.find(m => m.isMe)?.position || "?"}</div>
                </div>
                <div style={{ textAlign: "right" }}>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>Your Payout In</div>
                  <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>
                    {((members.find(m => m.isMe)?.position || 1) - ac.currentRound)} rounds
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* â”€â”€â”€ MEMBERS TAB â”€â”€â”€ */}
        {circleTab === "members" && (
          <div>
            {members.map((m, i) => {
              const isEmpty = m.role === "empty";
              return (
                <div key={i} style={{
                  display: "flex", alignItems: "center", gap: 12, padding: "12px 14px",
                  background: isEmpty ? "rgba(255,255,255,0.02)" : m.status === "delinquent" ? "rgba(239,68,68,0.04)" : "linear-gradient(145deg, #111827, #1A2332)",
                  borderRadius: 12, marginBottom: 6,
                  border: m.isMe ? "1px solid rgba(59,130,246,0.2)" : m.status === "delinquent" ? "1px solid rgba(239,68,68,0.12)" : "1px solid rgba(255,255,255,0.04)",
                  opacity: isEmpty ? 0.4 : 1,
                }}>
                  <div style={{ width: 36, height: 36, borderRadius: "50%", background: isEmpty ? "rgba(255,255,255,0.06)" : m.role === "manager" ? "linear-gradient(135deg, #A855F7, #7C3AED)" : "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, color: "#fff" }}>
                    {m.avatar}
                  </div>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                      <span style={{ fontSize: 12, fontWeight: 700, color: m.isMe ? "#60A5FA" : "#fff" }}>
                        {m.name} {m.isMe ? "(You)" : ""}
                      </span>
                      {m.role === "manager" && <span style={{ fontSize: 8, padding: "1px 5px", borderRadius: 4, background: "rgba(168,85,247,0.15)", color: "#A855F7", fontWeight: 700 }}>MGR</span>}
                      <span style={{ fontSize: 9, color: "rgba(255,255,255,0.2)" }}>#{m.position}</span>
                    </div>
                    <div style={{ display: "flex", alignItems: "center", gap: 6, marginTop: 2 }}>
                      {!isEmpty && <span style={{ fontSize: 9, color: "rgba(255,255,255,0.3)" }}>{m.rating}â˜…</span>}
                      {m.joinedVia === "vouched" && (
                        <span style={{ fontSize: 8, padding: "1px 5px", borderRadius: 3, background: "rgba(245,158,11,0.1)", color: "#FBBF24" }}>
                          Vouched by {m.vouchedBy}
                        </span>
                      )}
                      {m.lateBy && <span style={{ fontSize: 8, color: "#EF4444" }}>â° {m.lateBy} late</span>}
                    </div>
                  </div>

                  {/* Status + Actions */}
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    {!isEmpty && (
                      <span style={{
                        width: 8, height: 8, borderRadius: "50%",
                        background: m.status === "paid" ? "#00D65B" : m.status === "delinquent" ? "#EF4444" : m.status === "late" ? "#F59E0B" : "#6B7280",
                      }} />
                    )}
                    {!isEmpty && !m.isMe && (
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          if (!isFriend(m.name)) setFriendsList(p => [...p, m.name]);
                        }}
                        style={{
                          padding: "4px 8px", borderRadius: 6, border: "none", fontSize: 9, fontWeight: 600, cursor: "pointer",
                          background: isFriend(m.name) ? "rgba(0,177,79,0.1)" : "rgba(59,130,246,0.1)",
                          color: isFriend(m.name) ? "#00D65B" : "#60A5FA",
                        }}
                      >
                        {isFriend(m.name) ? "Friends âœ“" : "+ Add"}
                      </button>
                    )}
                  </div>
                </div>
              );
            })}

            {/* Friends in this circle */}
            <div style={{ marginTop: 12, padding: "12px 14px", background: "rgba(59,130,246,0.06)", borderRadius: 12, border: "1px solid rgba(59,130,246,0.08)" }}>
              <div style={{ fontSize: 10, fontWeight: 700, color: "#60A5FA", marginBottom: 6, letterSpacing: 0.5 }}>YOUR FRIENDS IN THIS CIRCLE</div>
              <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
                {members.filter(m => isFriend(m.name) && !m.isMe).map((f, i) => (
                  <span key={i} style={{ fontSize: 10, padding: "4px 8px", borderRadius: 6, background: "rgba(59,130,246,0.1)", color: "#60A5FA" }}>
                    {f.avatar} {f.name}
                  </span>
                ))}
                {members.filter(m => isFriend(m.name) && !m.isMe).length === 0 && (
                  <span style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>Add members above to see them here</span>
                )}
              </div>
              <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)", marginTop: 6 }}>Friends can be private messaged across all your circles</div>
            </div>
          </div>
        )}

        {/* â”€â”€â”€ CHAT TAB â”€â”€â”€ */}
        {circleTab === "chat" && (
          <div style={{ display: "flex", flexDirection: "column", height: 420 }}>
            {/* Messages */}
            <div style={{ flex: 1, overflowY: "auto", marginBottom: 12, display: "flex", flexDirection: "column", gap: 6 }}>
              {messages.map((msg) => (
                <div key={msg.id} style={{ display: "flex", flexDirection: msg.isMe ? "row-reverse" : "row", gap: 8, alignItems: "flex-end" }}>
                  {!msg.isMe && (
                    <div style={{ width: 28, height: 28, borderRadius: "50%", flexShrink: 0, background: msg.isManager ? "linear-gradient(135deg, #A855F7, #7C3AED)" : "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, fontWeight: 700, color: "#fff" }}>{msg.avatar}</div>
                  )}
                  <div style={{
                    maxWidth: "75%", padding: "10px 14px", borderRadius: msg.isMe ? "14px 14px 4px 14px" : "14px 14px 14px 4px",
                    background: msg.isMe ? "linear-gradient(135deg, #00B14F, #00D65B)" : msg.isManager ? "rgba(168,85,247,0.12)" : "rgba(255,255,255,0.06)",
                  }}>
                    {!msg.isMe && (
                      <div style={{ fontSize: 9, fontWeight: 700, color: msg.isManager ? "#A855F7" : "#60A5FA", marginBottom: 2, display: "flex", alignItems: "center", gap: 4 }}>
                        {msg.sender}
                        {msg.isManager && <span style={{ fontSize: 7, padding: "1px 4px", borderRadius: 3, background: "rgba(168,85,247,0.2)", color: "#A855F7" }}>MGR</span>}
                        {isFriend(msg.sender) && <span style={{ fontSize: 7, padding: "1px 4px", borderRadius: 3, background: "rgba(59,130,246,0.15)", color: "#60A5FA" }}>Friend</span>}
                      </div>
                    )}
                    <div style={{ fontSize: 12, color: msg.isMe ? "#fff" : "rgba(255,255,255,0.7)", lineHeight: 1.4 }}>{msg.text}</div>
                    <div style={{ fontSize: 8, color: msg.isMe ? "rgba(255,255,255,0.6)" : "rgba(255,255,255,0.2)", marginTop: 3, textAlign: msg.isMe ? "right" : "left" }}>{msg.time}</div>
                  </div>
                </div>
              ))}
            </div>

            {/* Chat Input */}
            <div style={{ display: "flex", gap: 8 }}>
              <input
                value={chatInput}
                onChange={(e) => setChatInput(e.target.value)}
                placeholder="Message the circle..."
                style={{ flex: 1, padding: "12px 16px", borderRadius: 24, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, outline: "none" }}
                onKeyDown={(e) => {
                  if (e.key === "Enter" && chatInput.trim()) {
                    const newMsg = { id: Date.now(), sender: "You", avatar: "MS", text: chatInput, time: "Now", isMe: true };
                    mockChats[ac.id] = [...(mockChats[ac.id] || []), newMsg];
                    setChatInput("");
                    setChatMessages(p => [...p, newMsg]);
                  }
                }}
              />
              <button
                onClick={() => {
                  if (chatInput.trim()) {
                    const newMsg = { id: Date.now(), sender: "You", avatar: "MS", text: chatInput, time: "Now", isMe: true };
                    mockChats[ac.id] = [...(mockChats[ac.id] || []), newMsg];
                    setChatInput("");
                    setChatMessages(p => [...p, newMsg]);
                  }
                }}
                style={{ width: 44, height: 44, borderRadius: "50%", border: "none", background: "linear-gradient(135deg, #00B14F, #00D65B)", cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16, color: "#fff" }}
              >
                â†‘
              </button>
            </div>
          </div>
        )}
      </div>
    );
  }

  // â”€â”€â”€ Circle Detail Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (selectedCircle) {
    const c = selectedCircle;
    const isApplying = applyingTo === c.id;
    return (
      <div style={{ padding: "0 20px 20px" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
          <button onClick={() => { setSelectedCircle(null); setApplyingTo(null); }} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
          <div style={{ flex: 1, fontSize: 18, fontWeight: 700, color: "#fff" }}>Circle Details</div>
          <Logo size={24} variant="icon" />
        </div>

        {/* Circle Header Card */}
        <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 20, padding: "24px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
          <div style={{ display: "flex", alignItems: "center", gap: 14, marginBottom: 16 }}>
            <div style={{ width: 56, height: 56, borderRadius: 16, background: "rgba(0,177,79,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 28 }}>{c.emoji}</div>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>{c.name}</div>
              <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", marginTop: 2, display: "flex", alignItems: "center", gap: 6 }}>
                <span>ğŸ“</span> {c.location} Â· {c.distance}
              </div>
            </div>
            <span style={{ padding: "4px 10px", borderRadius: 20, background: c.status === "active" ? "rgba(0,177,79,0.15)" : "rgba(245,158,11,0.15)", color: c.status === "active" ? "#00D65B" : "#F59E0B", fontSize: 11, fontWeight: 700 }}>
              {c.status === "active" ? "Active" : "Forming"}
            </span>
          </div>

          {/* Stats Grid */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 16 }}>
            {[
              { label: "Monthly", value: formatCurrency(c.monthlyContribution, r.symbol) },
              { label: "Members", value: `${c.members}/${c.maxMembers}` },
              { label: "Round", value: `${c.currentRound}/${c.totalRounds}` },
              { label: "Spots Left", value: c.spotsLeft || (c.maxMembers - c.members), highlight: true },
            ].map((s, i) => (
              <div key={i} style={{ padding: "12px", background: "rgba(255,255,255,0.03)", borderRadius: 10 }}>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 600, letterSpacing: 0.5 }}>{s.label}</div>
                <div style={{ fontSize: 15, fontWeight: 700, color: s.highlight ? "#00D65B" : "#fff", marginTop: 4 }}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* How to Join */}
          <div style={{ padding: "12px 14px", background: "rgba(255,255,255,0.03)", borderRadius: 12, marginBottom: 16 }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.5)", marginBottom: 8, letterSpacing: 0.5 }}>HOW TO JOIN</div>
            <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                  <span style={{ fontSize: 14 }}>{meetsRating(c.minRating) ? "âœ…" : "âŒ"}</span>
                  <span style={{ fontSize: 12, color: "rgba(255,255,255,0.6)" }}>Min. Rating: {c.minRating} stars</span>
                </div>
                <span style={{ fontSize: 11, color: meetsRating(c.minRating) ? "#00D65B" : "#EF4444", fontWeight: 600 }}>
                  You: {userRating}
                </span>
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <span style={{ fontSize: 14 }}>{meetsRating(c.minRating) && userRating >= 4.0 ? "âœ…" : "ğŸ”’"}</span>
                <span style={{ fontSize: 12, color: "rgba(255,255,255,0.6)" }}>
                  {userRating >= 4.0 ? "Direct join â€” no bond needed" : "Requires a member to vouch for you (50% bond)"}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Manager Card */}
        <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
          <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", marginBottom: 12, letterSpacing: 0.5 }}>MANAGED BY</div>
          <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
            <div style={{ width: 44, height: 44, borderRadius: "50%", background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 700, color: "#fff", position: "relative" }}>
              {c.manager.avatar}
              {c.manager.verified && (
                <span style={{ position: "absolute", bottom: -2, right: -2, background: "#00B14F", borderRadius: "50%", width: 16, height: 16, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, border: "2px solid #111827" }}>âœ“</span>
              )}
            </div>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 14, fontWeight: 700, color: "#fff", display: "flex", alignItems: "center", gap: 6 }}>
                {c.manager.name}
                {c.manager.verified && <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 6, background: "rgba(0,177,79,0.15)", color: "#00D65B", fontWeight: 700 }}>VERIFIED</span>}
              </div>
              <div style={{ marginTop: 4 }}>{renderStars(c.manager.rating, 11)}</div>
            </div>
          </div>
        </div>

        {/* Join Action â€” Smart Vouch based */}
        {!isApplying ? (
          <div>
            {/* Direct join for trusted members */}
            {meetsRating(c.minRating) && userRating >= 4.0 ? (
              <button
                onClick={() => { setSelectedCircle(null); }}
                style={{ width: "100%", padding: "16px", borderRadius: 14, border: "none", background: "linear-gradient(135deg, #00B14F, #00D65B)", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", boxShadow: "0 4px 20px rgba(0,177,79,0.3)" }}
              >
                Join Circle (No Bond Needed)
              </button>
            ) : meetsRating(c.minRating) ? (
              /* Needs a vouch */
              <div>
                <div style={{ padding: "14px", background: "rgba(245,158,11,0.06)", borderRadius: 12, border: "1px solid rgba(245,158,11,0.12)", marginBottom: 12 }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}>
                    <span style={{ fontSize: 16 }}>ğŸ¤</span>
                    <div style={{ fontSize: 13, fontWeight: 700, color: "#FBBF24" }}>Vouch Required</div>
                  </div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.45)", lineHeight: 1.5 }}>
                    Your rating ({userRating}â˜…) is below 4.0â˜…. Ask an existing member of this circle to vouch for you. They will stake a {formatCurrency((c.monthlyContribution || 1000) * 0.5, r.symbol)} bond.
                  </div>
                </div>
                <button
                  onClick={() => setApplyingTo(c.id)}
                  style={{ width: "100%", padding: "16px", borderRadius: 14, border: "none", background: "linear-gradient(135deg, #F59E0B, #D97706)", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", boxShadow: "0 4px 20px rgba(245,158,11,0.3)" }}
                >
                  Request a Vouch
                </button>
              </div>
            ) : (
              <button
                style={{ width: "100%", padding: "16px", borderRadius: 14, border: "none", background: "rgba(255,255,255,0.06)", color: "rgba(255,255,255,0.25)", fontSize: 15, fontWeight: 700, cursor: "not-allowed" }}
              >
                Rating too low (need {c.minRating}â˜…)
              </button>
            )}
          </div>
        ) : (
          /* Request Vouch Form */
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "20px", border: "1px solid rgba(245,158,11,0.15)" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
              <span style={{ fontSize: 18 }}>ğŸ¤</span>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#FBBF24" }}>Request a Vouch for {c.name}</div>
            </div>
            <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", marginBottom: 12 }}>
              Send a vouch request to an existing member. They'll need to stake {formatCurrency((c.monthlyContribution || 1000) * 0.5, r.symbol)} as a trust bond.
            </div>
            <input
              placeholder="Enter member's email or name"
              style={{ width: "100%", padding: "14px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, outline: "none", marginBottom: 10, boxSizing: "border-box" }}
            />
            <textarea
              value={applicationNote}
              onChange={(e) => setApplicationNote(e.target.value)}
              placeholder="Add a message â€” why should they vouch for you?"
              style={{ width: "100%", padding: "14px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, minHeight: 70, outline: "none", resize: "vertical", fontFamily: "inherit", boxSizing: "border-box" }}
            />
            <div style={{ display: "flex", gap: 10, marginTop: 12 }}>
              <button onClick={() => setApplyingTo(null)} style={{ flex: 1, padding: "12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.1)", background: "none", color: "rgba(255,255,255,0.5)", fontSize: 13, fontWeight: 600, cursor: "pointer" }}>
                Cancel
              </button>
              <button
                onClick={() => { setApplyingTo(null); setSelectedCircle(null); setApplicationNote(""); }}
                style={{ flex: 2, padding: "12px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #F59E0B, #D97706)", color: "#fff", fontSize: 13, fontWeight: 700, cursor: "pointer", boxShadow: "0 4px 16px rgba(245,158,11,0.3)" }}
              >
                Send Vouch Request
              </button>
            </div>
          </div>
        )}
      </div>
    );
  }

  // â”€â”€â”€ Create Circle Flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (showCreateFlow) {
    const meetsCompletionReq = userStats.completedCircles >= MANAGER_REQUIREMENTS.minCompletedCircles;
    const meetsRatingReq = userStats.avgRating >= MANAGER_REQUIREMENTS.minAvgRating;
    const meetsKYC = userStats.kycVerified;
    const meetsBank = userStats.bankVerified;
    const allEligible = meetsCompletionReq && meetsRatingReq && meetsKYC && meetsBank;
    const reliabilityScore = userStats.onTimePayments > 0
      ? Math.round((userStats.onTimePayments / (userStats.onTimePayments + userStats.latePayments + userStats.missedPayments)) * 100)
      : 0;

    // Step: Eligibility Check
    if (createStep === "eligibility") {
      return (
        <div style={{ padding: "0 20px 20px" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
            <button onClick={() => { setShowCreateFlow(false); setCreateStep("eligibility"); }} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
            <div style={{ flex: 1, fontSize: 18, fontWeight: 700, color: "#fff" }}>Become a Manager</div>
            <Logo size={24} variant="icon" />
          </div>

          {/* Hero */}
          <div style={{ background: "linear-gradient(145deg, #1A1125, #231530)", borderRadius: 20, padding: "28px 24px", border: "1px solid rgba(168,85,247,0.15)", marginBottom: 20, textAlign: "center" }}>
            <div style={{ fontSize: 40, marginBottom: 12 }}>ğŸ‘‘</div>
            <div style={{ fontSize: 20, fontWeight: 800, color: "#fff", marginBottom: 6 }}>Create Your Own Circle</div>
            <div style={{ fontSize: 13, color: "rgba(255,255,255,0.45)", lineHeight: 1.5 }}>
              Managing a circle is a responsibility. We verify every manager to keep the community safe.
            </div>
          </div>

          {/* Eligibility Checklist */}
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "20px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
            <div style={{ fontSize: 12, fontWeight: 700, color: "rgba(255,255,255,0.5)", marginBottom: 16, letterSpacing: 0.5 }}>ELIGIBILITY REQUIREMENTS</div>

            {[
              {
                met: meetsCompletionReq,
                label: `Complete ${MANAGER_REQUIREMENTS.minCompletedCircles} circles as a member`,
                detail: `You: ${userStats.completedCircles}/${MANAGER_REQUIREMENTS.minCompletedCircles} completed`,
                icon: "ğŸ”„",
              },
              {
                met: meetsRatingReq,
                label: `Maintain ${MANAGER_REQUIREMENTS.minAvgRating}â˜… average rating`,
                detail: `You: ${userStats.avgRating}â˜… average`,
                icon: "â­",
              },
              {
                met: meetsKYC,
                label: "Complete KYC identity verification",
                detail: meetsKYC ? "Verified" : "Not yet verified",
                icon: "ğŸªª",
              },
              {
                met: meetsBank,
                label: "Verified bank account linked",
                detail: meetsBank ? `${userStats.bankName} â€¢â€¢â€¢â€¢${userStats.bankLast4}` : "No bank account linked",
                icon: "ğŸ¦",
              },
              {
                met: true, // informational
                label: "Security deposit (1Ã— monthly pot)",
                detail: "Locked in escrow until circle completes",
                icon: "ğŸ”",
                isInfo: true,
              },
              {
                met: false,
                label: "Company review & approval",
                detail: "Required for all new managers",
                icon: "ğŸ¢",
                isCompanyReview: true,
              },
            ].map((req, i) => (
              <div key={i} style={{ display: "flex", gap: 12, padding: "14px 0", borderBottom: i < 5 ? "1px solid rgba(255,255,255,0.04)" : "none" }}>
                <div style={{
                  width: 40, height: 40, borderRadius: 12, flexShrink: 0,
                  background: req.isCompanyReview ? "rgba(168,85,247,0.1)" : req.isInfo ? "rgba(59,130,246,0.1)" : req.met ? "rgba(0,177,79,0.1)" : "rgba(239,68,68,0.08)",
                  display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18,
                }}>
                  {req.icon}
                </div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 13, fontWeight: 600, color: "#fff", marginBottom: 3 }}>{req.label}</div>
                  <div style={{ fontSize: 11, color: req.isCompanyReview ? "#A855F7" : req.isInfo ? "#60A5FA" : req.met ? "#00D65B" : "#EF4444", fontWeight: 600 }}>
                    {req.isCompanyReview ? "ğŸ”’ Pending your application" : req.isInfo ? "â„¹ï¸ " : req.met ? "âœ“ " : "âœ• "}{req.detail}
                  </div>
                </div>
                <div style={{ display: "flex", alignItems: "center" }}>
                  {req.isCompanyReview ? (
                    <span style={{ width: 24, height: 24, borderRadius: "50%", background: "rgba(168,85,247,0.15)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, color: "#A855F7" }}>ğŸ”’</span>
                  ) : req.isInfo ? (
                    <span style={{ width: 24, height: 24, borderRadius: "50%", background: "rgba(59,130,246,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, color: "#60A5FA" }}>â„¹</span>
                  ) : (
                    <span style={{
                      width: 24, height: 24, borderRadius: "50%",
                      background: req.met ? "rgba(0,177,79,0.15)" : "rgba(239,68,68,0.1)",
                      display: "flex", alignItems: "center", justifyContent: "center",
                      fontSize: 12, color: req.met ? "#00D65B" : "#EF4444",
                    }}>
                      {req.met ? "âœ“" : "âœ•"}
                    </span>
                  )}
                </div>
              </div>
            ))}
          </div>

          {/* Your Track Record Card */}
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "20px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 20 }}>
            <div style={{ fontSize: 12, fontWeight: 700, color: "rgba(255,255,255,0.5)", marginBottom: 14, letterSpacing: 0.5 }}>YOUR TRACK RECORD</div>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 10 }}>
              {[
                { label: "Completed", value: userStats.completedCircles, color: "#00D65B" },
                { label: "On-Time", value: `${reliabilityScore}%`, color: "#60A5FA" },
                { label: "Contributed", value: `${r.symbol}${(userStats.totalContributed / 1000).toFixed(0)}K`, color: "#FBBF24" },
              ].map((s, i) => (
                <div key={i} style={{ textAlign: "center", padding: "14px 8px", background: "rgba(255,255,255,0.03)", borderRadius: 10 }}>
                  <div style={{ fontSize: 22, fontWeight: 800, color: s.color }}>{s.value}</div>
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", marginTop: 4, fontWeight: 600 }}>{s.label}</div>
                </div>
              ))}
            </div>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginTop: 10 }}>
              <div style={{ padding: "10px 12px", background: "rgba(255,255,255,0.03)", borderRadius: 10, display: "flex", justifyContent: "space-between" }}>
                <span style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>Late Payments</span>
                <span style={{ fontSize: 11, fontWeight: 700, color: userStats.latePayments > 3 ? "#EF4444" : "#FBBF24" }}>{userStats.latePayments}</span>
              </div>
              <div style={{ padding: "10px 12px", background: "rgba(255,255,255,0.03)", borderRadius: 10, display: "flex", justifyContent: "space-between" }}>
                <span style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>Missed</span>
                <span style={{ fontSize: 11, fontWeight: 700, color: userStats.missedPayments > 0 ? "#EF4444" : "#00D65B" }}>{userStats.missedPayments}</span>
              </div>
            </div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.25)", marginTop: 10, textAlign: "center" }}>
              Member since {new Date(userStats.memberSince).toLocaleDateString("en", { month: "long", year: "numeric" })}
            </div>
          </div>

          <button
            onClick={() => allEligible ? setCreateStep("form") : null}
            style={{
              width: "100%", padding: "16px", borderRadius: 14, border: "none",
              background: allEligible ? "linear-gradient(135deg, #A855F7, #7C3AED)" : "rgba(255,255,255,0.06)",
              color: allEligible ? "#fff" : "rgba(255,255,255,0.25)",
              fontSize: 15, fontWeight: 700,
              cursor: allEligible ? "pointer" : "not-allowed",
              boxShadow: allEligible ? "0 4px 20px rgba(168,85,247,0.3)" : "none",
            }}
          >
            {allEligible ? "Continue to Application" : "Requirements Not Met"}
          </button>

          {!allEligible && (
            <div style={{ textAlign: "center", marginTop: 12, fontSize: 12, color: "rgba(255,255,255,0.3)" }}>
              Complete the requirements above to unlock manager applications.
            </div>
          )}
        </div>
      );
    }

    // Step: Manager Application Form
    if (createStep === "form") {
      const isFormValid = managerApp.circleName.length >= 3 && managerApp.reason.length >= 20 && managerApp.monthlyContribution && managerApp.idUploaded;
      return (
        <div style={{ padding: "0 20px 20px" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
            <button onClick={() => setCreateStep("eligibility")} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Manager Application</div>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Step 1 of 2 â€” Circle Details</div>
            </div>
            <Logo size={24} variant="icon" />
          </div>

          {/* Progress Steps */}
          <div style={{ display: "flex", gap: 6, marginBottom: 20 }}>
            <div style={{ flex: 1, height: 3, borderRadius: 2, background: "linear-gradient(90deg, #A855F7, #7C3AED)" }} />
            <div style={{ flex: 1, height: 3, borderRadius: 2, background: "rgba(255,255,255,0.06)" }} />
          </div>

          {/* Circle Name */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
              CIRCLE NAME *
            </label>
            <input
              value={managerApp.circleName}
              onChange={(e) => setManagerApp(p => ({ ...p, circleName: e.target.value }))}
              placeholder="e.g. Tondo Community Savers"
              style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box" }}
            />
          </div>

          {/* Description */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
              DESCRIPTION
            </label>
            <textarea
              value={managerApp.description}
              onChange={(e) => setManagerApp(p => ({ ...p, description: e.target.value }))}
              placeholder="Describe what this circle is for and who should join..."
              rows={3}
              style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, outline: "none", resize: "vertical", fontFamily: "inherit", boxSizing: "border-box" }}
            />
          </div>

          {/* Amount & Members Row */}
          <div style={{ display: "flex", gap: 10, marginBottom: 16 }}>
            <div style={{ flex: 1 }}>
              <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
                MONTHLY ({r.currency}) *
              </label>
              <input
                type="number"
                value={managerApp.monthlyContribution}
                onChange={(e) => setManagerApp(p => ({ ...p, monthlyContribution: e.target.value }))}
                placeholder="1,000"
                style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box" }}
              />
            </div>
            <div style={{ flex: 1 }}>
              <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
                MAX MEMBERS
              </label>
              <select
                value={managerApp.maxMembers}
                onChange={(e) => setManagerApp(p => ({ ...p, maxMembers: e.target.value }))}
                style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "#111827", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box", appearance: "none" }}
              >
                {[5, 8, 10, 12, 15, 20].map(n => <option key={n} value={n}>{n} members</option>)}
              </select>
            </div>
          </div>

          {/* Rounds & Location */}
          <div style={{ display: "flex", gap: 10, marginBottom: 16 }}>
            <div style={{ flex: 1 }}>
              <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
                TOTAL ROUNDS
              </label>
              <select
                value={managerApp.totalRounds}
                onChange={(e) => setManagerApp(p => ({ ...p, totalRounds: e.target.value }))}
                style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "#111827", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box", appearance: "none" }}
              >
                {[5, 8, 10, 12].map(n => <option key={n} value={n}>{n} rounds</option>)}
              </select>
            </div>
            <div style={{ flex: 1 }}>
              <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
                MIN RATING
              </label>
              <select
                value={managerApp.minRating}
                onChange={(e) => setManagerApp(p => ({ ...p, minRating: e.target.value }))}
                style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "#111827", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box", appearance: "none" }}
              >
                {["3.0", "3.5", "4.0", "4.5", "4.8"].map(n => <option key={n} value={n}>{n}â˜… minimum</option>)}
              </select>
            </div>
          </div>

          {/* Location */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
              LOCATION (for discovery)
            </label>
            <input
              value={managerApp.location}
              onChange={(e) => setManagerApp(p => ({ ...p, location: e.target.value }))}
              placeholder="e.g. Tondo, Manila"
              style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, outline: "none", boxSizing: "border-box" }}
            />
          </div>

          {/* â”€â”€â”€ Manager Career Path â”€â”€â”€ */}
          <div style={{ background: `linear-gradient(145deg, ${currentLevel.color}11, ${currentLevel.color}08)`, borderRadius: 16, padding: "20px", border: `1px solid ${currentLevel.color}30`, marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 4 }}>
              <span style={{ fontSize: 28 }}>{currentLevel.emoji}</span>
              <div style={{ flex: 1 }}>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", fontWeight: 600, letterSpacing: 0.5 }}>YOU START AS</div>
                <div style={{ fontSize: 18, fontWeight: 800, color: currentLevel.color }}>The {currentLevel.title}</div>
              </div>
            </div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginBottom: 16 }}>{currentLevel.subtitle} â€” {currentLevel.promotionGoal}</div>

            {/* All 3 Tiers - Career Ladder */}
            <div style={{ display: "flex", gap: 6, marginBottom: 16 }}>
              {MANAGER_LEVELS.map((lvl) => {
                const isCurrent = lvl.level === currentLevel.level;
                const isLocked = lvl.level > currentLevel.level;
                return (
                  <div key={lvl.level} style={{
                    flex: 1, padding: "12px 8px", borderRadius: 12, textAlign: "center",
                    background: isCurrent ? `${lvl.color}18` : "rgba(255,255,255,0.03)",
                    border: isCurrent ? `2px solid ${lvl.color}` : "1px solid rgba(255,255,255,0.06)",
                    opacity: isLocked ? 0.4 : 1,
                  }}>
                    <div style={{ fontSize: 22, marginBottom: 2 }}>{lvl.emoji}</div>
                    <div style={{ fontSize: 9, fontWeight: 800, color: isCurrent ? lvl.color : "rgba(255,255,255,0.4)", letterSpacing: 0.5 }}>{lvl.title.toUpperCase()}</div>
                    <div style={{ fontSize: 18, fontWeight: 800, color: isCurrent ? "#fff" : "rgba(255,255,255,0.3)", marginTop: 4 }}>{lvl.feePercent}%</div>
                    <div style={{ fontSize: 8, color: "rgba(255,255,255,0.25)", marginTop: 4 }}>{lvl.totalFee}% total fee</div>
                    <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "6px 0" }} />
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.35)" }}>{lvl.maxCircles} circles</div>
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.35)" }}>{lvl.maxTotalMembers} members</div>
                    <div style={{ fontSize: 9, color: "#FBBF24", marginTop: 4 }}>{formatCurrency(lvl.securityDeposit, r.symbol)}</div>
                    {isLocked && <div style={{ fontSize: 9, marginTop: 4 }}>ğŸ”’</div>}
                  </div>
                );
              })}
            </div>

            {/* Income Projection Table */}
            <div style={{ background: "rgba(0,0,0,0.2)", borderRadius: 12, padding: "14px", marginBottom: 12 }}>
              <div style={{ fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.35)", marginBottom: 10, letterSpacing: 0.5 }}>INCOME POTENTIAL (â‚±20,000 POT SIZE)</div>
              <div style={{ display: "grid", gridTemplateColumns: "auto 1fr 1fr 1fr", gap: "6px 10px", fontSize: 10 }}>
                <span style={{ color: "rgba(255,255,255,0.25)", fontWeight: 700 }}>Level</span>
                <span style={{ color: "rgba(255,255,255,0.25)", fontWeight: 700, textAlign: "right" }}>Circles</span>
                <span style={{ color: "rgba(255,255,255,0.25)", fontWeight: 700, textAlign: "right" }}>Monthly</span>
                <span style={{ color: "rgba(255,255,255,0.25)", fontWeight: 700, textAlign: "right" }}>Annual</span>
                {MANAGER_LEVELS.map((lvl) => (
                  <>
                    <span key={`n${lvl.level}`} style={{ color: lvl.color, fontWeight: 700 }}>{lvl.emoji} {lvl.title}</span>
                    <span key={`c${lvl.level}`} style={{ color: "rgba(255,255,255,0.5)", textAlign: "right" }}>{lvl.maxCircles}</span>
                    <span key={`m${lvl.level}`} style={{ color: "#fff", fontWeight: 700, textAlign: "right" }}>{formatCurrency(lvl.monthlyIncome, r.symbol)}</span>
                    <span key={`a${lvl.level}`} style={{ color: "#00D65B", fontWeight: 700, textAlign: "right" }}>{formatCurrency(lvl.annualIncome, r.symbol)}</span>
                  </>
                ))}
              </div>
            </div>

            {/* Promotion Path to Next Level */}
            {nextLevel && (
              <div style={{ padding: "12px 14px", background: `${nextLevel.color}08`, borderRadius: 10, border: `1px dashed ${nextLevel.color}25` }}>
                <div style={{ fontSize: 10, fontWeight: 700, color: nextLevel.color, marginBottom: 8, letterSpacing: 0.5 }}>
                  PROMOTION TO {nextLevel.title.toUpperCase()} â€” {nextLevel.feePercent}% fee Â· {nextLevel.maxCircles} circles
                </div>
                {nextLevel.promotionCriteria.map((criteria, i) => (
                  <div key={i} style={{ display: "flex", gap: 8, padding: "3px 0", fontSize: 11, alignItems: "flex-start" }}>
                    <span style={{ color: "rgba(255,255,255,0.2)", fontSize: 10, marginTop: 1 }}>â—‹</span>
                    <span style={{ color: "rgba(255,255,255,0.5)" }}>{criteria}</span>
                  </div>
                ))}
              </div>
            )}

            {/* Demotion Warning */}
            <div style={{ marginTop: 12, padding: "10px 14px", background: "rgba(239,68,68,0.06)", borderRadius: 10, border: "1px solid rgba(239,68,68,0.12)" }}>
              <div style={{ display: "flex", alignItems: "center", gap: 6, marginBottom: 4 }}>
                <span style={{ fontSize: 12 }}>âš ï¸</span>
                <span style={{ fontSize: 10, fontWeight: 700, color: "#EF4444", letterSpacing: 0.5 }}>DEMOTION RULE</span>
              </div>
              <div style={{ fontSize: 10, color: "rgba(255,255,255,0.4)", lineHeight: 1.5 }}>
                If your rating drops below {DEMOTION_RULES.ratingThreshold}â˜…, you are automatically demoted to the previous level. Capacity is reduced immediately. {DEMOTION_RULES.maxDefaultsBeforeBan} defaults = permanent ban.
              </div>
            </div>
          </div>

          {/* â”€â”€â”€ Review & Rating System â”€â”€â”€ */}
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 14 }}>
              <span style={{ fontSize: 18 }}>ğŸ“‹</span>
              <div>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>How Members Rate You</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Reviews happen automatically at key moments</div>
              </div>
            </div>

            {/* When reviews happen */}
            <div style={{ marginBottom: 12 }}>
              {DEMOTION_RULES.reviewTriggers.map((trigger, i) => (
                <div key={i} style={{ display: "flex", gap: 10, padding: "8px 12px", background: "rgba(255,255,255,0.03)", borderRadius: 8, marginBottom: 4 }}>
                  <span style={{ fontSize: 14 }}>{trigger.event === "after_payout" ? "ğŸ’¸" : "ğŸ"}</span>
                  <div>
                    <div style={{ fontSize: 11, fontWeight: 600, color: "rgba(255,255,255,0.6)" }}>{trigger.event === "after_payout" ? "After Each Payout" : "End of Circle"}</div>
                    <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)", fontStyle: "italic" }}>"{trigger.question}"</div>
                  </div>
                </div>
              ))}
            </div>

            {/* Star meanings */}
            <div style={{ fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.3)", marginBottom: 8, letterSpacing: 0.5 }}>RATING GUIDE</div>
            {DEMOTION_RULES.ratingGuide.map((guide, i) => (
              <div key={i} style={{ display: "flex", alignItems: "center", gap: 8, padding: "4px 0" }}>
                <div style={{ display: "flex", gap: 1, width: 60 }}>
                  {[...Array(5)].map((_, s) => (
                    <span key={s} style={{ fontSize: 10, color: s < guide.stars ? "#FBBF24" : "rgba(255,255,255,0.1)" }}>â˜…</span>
                  ))}
                </div>
                <span style={{ fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.5)", width: 44 }}>{guide.label}</span>
                <span style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>{guide.desc}</span>
              </div>
            ))}
          </div>

          {/* â”€â”€â”€ Earnings for This Circle â”€â”€â”€ */}
          {managerApp.monthlyContribution && (
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
              <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", marginBottom: 12, letterSpacing: 0.5 }}>EARNINGS â€” THIS CIRCLE</div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 12 }}>
                <div style={{ padding: "12px", background: "rgba(255,255,255,0.04)", borderRadius: 10 }}>
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>Per Round</div>
                  <div style={{ fontSize: 18, fontWeight: 800, color: currentLevel.color, marginTop: 2 }}>{formatCurrency(computeManagerEarnings().perRound, r.symbol)}</div>
                </div>
                <div style={{ padding: "12px", background: "rgba(255,255,255,0.04)", borderRadius: 10 }}>
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>Total ({managerApp.totalRounds} rounds)</div>
                  <div style={{ fontSize: 18, fontWeight: 800, color: "#00D65B", marginTop: 2 }}>{formatCurrency(computeManagerEarnings().total, r.symbol)}</div>
                </div>
              </div>

              {/* Fee Breakdown */}
              {[
                { label: `${currentLevel.title} Fee`, value: `${currentLevel.feePercent}%`, color: currentLevel.color, desc: "Your earnings" },
                { label: "Platform Fee", value: `${PLATFORM_FEE}%`, color: "#60A5FA", desc: `${APP_NAME} (tech & security)` },
                { label: "Total to Winner", value: `${currentLevel.totalFee}%`, color: "#fff", desc: "Deducted from payout", bold: true },
              ].map((fee, i) => (
                <div key={i} style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "8px 0", borderBottom: i < 2 ? "1px solid rgba(255,255,255,0.04)" : "none" }}>
                  <div>
                    <div style={{ fontSize: 12, color: "rgba(255,255,255,0.6)", fontWeight: fee.bold ? 700 : 500 }}>{fee.label}</div>
                    <div style={{ fontSize: 9, color: "rgba(255,255,255,0.25)" }}>{fee.desc}</div>
                  </div>
                  <span style={{ fontSize: fee.bold ? 16 : 14, fontWeight: 700, color: fee.color }}>{fee.value}</span>
                </div>
              ))}
              <div style={{ marginTop: 8, padding: "10px 12px", background: "rgba(255,255,255,0.03)", borderRadius: 8, fontSize: 11, color: "rgba(255,255,255,0.4)", lineHeight: 1.5 }}>
                On a {formatCurrency(computeManagerEarnings().potPerRound, r.symbol)} pot, winner receives{" "}
                <strong style={{ color: "#00D65B" }}>
                  {formatCurrency(computeManagerEarnings().potPerRound * (1 - currentLevel.totalFee / 100), r.symbol)}
                </strong>{" "}
                after the {currentLevel.totalFee}% fee.
              </div>
            </div>
          )}

          {/* â”€â”€â”€ Security Deposit â”€â”€â”€ */}
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(245,158,11,0.15)", marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
              <span style={{ fontSize: 18 }}>ğŸ”</span>
              <div>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#FBBF24" }}>Security Deposit â€” {currentLevel.title}</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Fixed {formatCurrency(currentLevel.securityDeposit, r.symbol)} for Level {currentLevel.level} managers</div>
              </div>
            </div>

            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "14px 16px", background: "rgba(245,158,11,0.06)", borderRadius: 12, marginBottom: 10 }}>
              <div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Deposit Amount</div>
                <div style={{ fontSize: 22, fontWeight: 800, color: "#FBBF24" }}>{formatCurrency(computeSecurityDeposit(), r.symbol)}</div>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.25)", marginTop: 2 }}>ğŸ”— Locked and blockchain-verified</div>
              </div>
              <div style={{ textAlign: "right" }}>
                <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>Your wallet</div>
                <div style={{ fontSize: 14, fontWeight: 700, color: userStats.walletBalance >= computeSecurityDeposit() ? "#00D65B" : "#EF4444" }}>
                  {formatCurrency(userStats.walletBalance, r.symbol)}
                </div>
                <div style={{ fontSize: 10, color: userStats.walletBalance >= computeSecurityDeposit() ? "#00D65B" : "#EF4444", fontWeight: 600, marginTop: 2 }}>
                  {userStats.walletBalance >= computeSecurityDeposit() ? "âœ“ Sufficient" : "âœ• Cash In more funds"}
                </div>
              </div>
            </div>

            <div style={{ padding: "10px 12px", background: "rgba(0,0,0,0.15)", borderRadius: 8 }}>
              {[
                { icon: "ğŸ”’", text: "Locked and blockchain-verified when your circle goes live" },
                { icon: "âœ“", text: "Returned after all rounds with no disputes" },
                { icon: "âš ", text: "Forfeited on fraud, abandonment, or 2+ defaults" },
                { icon: "ğŸ“ˆ", text: `Increases with level: Rookie â‚±5K â†’ Captain â‚±10K â†’ Banker â‚±20K` },
              ].map((rule, i) => (
                <div key={i} style={{ display: "flex", gap: 8, alignItems: "flex-start", padding: "5px 0", fontSize: 11, color: "rgba(255,255,255,0.45)", lineHeight: 1.4 }}>
                  <span style={{ fontSize: 11, flexShrink: 0 }}>{rule.icon}</span>
                  <span>{rule.text}</span>
                </div>
              ))}
            </div>
          </div>

          {/* â”€â”€â”€ Bank Account â”€â”€â”€ */}
          <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 16 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 12 }}>
              <span style={{ fontSize: 18 }}>ğŸ¦</span>
              <div>
                <div style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>Linked Bank Account</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Required for payouts & deposit</div>
              </div>
            </div>

            {userStats.bankVerified ? (
              <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "14px 16px", background: "rgba(0,177,79,0.06)", borderRadius: 12, border: "1px solid rgba(0,177,79,0.12)" }}>
                <div style={{ width: 40, height: 40, borderRadius: 10, background: "rgba(0,177,79,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18 }}>ğŸ¦</div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 14, fontWeight: 700, color: "#fff" }}>{userStats.bankName}</div>
                  <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", fontFamily: "monospace" }}>â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ {userStats.bankLast4}</div>
                </div>
                <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(0,177,79,0.15)", color: "#00D65B", fontWeight: 700 }}>VERIFIED</span>
              </div>
            ) : (
              <button style={{ width: "100%", padding: "16px", borderRadius: 12, border: "2px dashed rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.02)", color: "rgba(255,255,255,0.4)", fontSize: 13, fontWeight: 600, cursor: "pointer", display: "flex", flexDirection: "column", alignItems: "center", gap: 6 }}>
                <span style={{ fontSize: 22 }}>ğŸ¦</span>
                Link your bank account
              </button>
            )}
          </div>

          {/* Smart Vouch Info */}
          <div style={{ padding: "14px 16px", background: "rgba(59,130,246,0.06)", borderRadius: 12, marginBottom: 20, border: "1px solid rgba(59,130,246,0.1)" }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 6 }}>
              <span style={{ fontSize: 14 }}>ğŸ¤</span>
              <div style={{ fontSize: 13, fontWeight: 600, color: "#60A5FA" }}>Smart Vouch Enabled</div>
            </div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", lineHeight: 1.5 }}>
              New members join through the vouch system. Trusted members (4.0â˜…+) join directly. Others need an existing member to stake a 50% bond.
            </div>
          </div>

          <button
            onClick={() => setCreateStep("review")}
            style={{
              width: "100%", padding: "16px", borderRadius: 14, border: "none",
              background: "linear-gradient(135deg, #A855F7, #7C3AED)",
              color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer",
              boxShadow: "0 4px 20px rgba(168,85,247,0.3)",
            }}
          >
            Next: Verification & Review
          </button>
        </div>
      );
    }

    // Step: Verification & Submit for Company Review
    if (createStep === "review") {
      const canSubmit = managerApp.idUploaded && managerApp.reason.length >= 20;
      return (
        <div style={{ padding: "0 20px 20px" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
            <button onClick={() => setCreateStep("form")} style={{ background: "none", border: "none", color: "#fff", fontSize: 20, cursor: "pointer", padding: 4 }}>â†</button>
            <div style={{ flex: 1 }}>
              <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Verification</div>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)" }}>Step 2 of 2 â€” Identity & Review</div>
            </div>
            <Logo size={24} variant="icon" />
          </div>

          {/* Progress Steps */}
          <div style={{ display: "flex", gap: 6, marginBottom: 20 }}>
            <div style={{ flex: 1, height: 3, borderRadius: 2, background: "linear-gradient(90deg, #A855F7, #7C3AED)" }} />
            <div style={{ flex: 1, height: 3, borderRadius: 2, background: "linear-gradient(90deg, #A855F7, #7C3AED)" }} />
          </div>

          {/* Company Review Notice */}
          <div style={{ background: "linear-gradient(145deg, #1A1125, #231530)", borderRadius: 16, padding: "20px", border: "1px solid rgba(168,85,247,0.2)", marginBottom: 20 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }}>
              <span style={{ fontSize: 22 }}>ğŸ¢</span>
              <div>
                <div style={{ fontSize: 14, fontWeight: 700, color: "#A855F7" }}>Company Review Required</div>
                <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>All manager applications are reviewed by {APP_NAME}</div>
              </div>
            </div>
            <div style={{ fontSize: 12, color: "rgba(255,255,255,0.45)", lineHeight: 1.6, padding: "10px 12px", background: "rgba(0,0,0,0.2)", borderRadius: 10 }}>
              Our team manually reviews every manager application to protect the community. This typically takes 2â€“5 business days. You'll be notified once a decision is made.
            </div>
          </div>

          {/* Upload ID */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 8, letterSpacing: 0.3 }}>
              VALID GOVERNMENT ID *
            </label>
            <button
              onClick={() => setManagerApp(p => ({ ...p, idUploaded: true }))}
              style={{
                width: "100%", padding: "24px 16px", borderRadius: 12, cursor: "pointer", transition: "all 0.2s",
                border: managerApp.idUploaded ? "2px solid #00B14F" : "2px dashed rgba(255,255,255,0.1)",
                background: managerApp.idUploaded ? "rgba(0,177,79,0.06)" : "rgba(255,255,255,0.02)",
                color: managerApp.idUploaded ? "#00D65B" : "rgba(255,255,255,0.3)",
                fontSize: 13, fontWeight: 600, display: "flex", flexDirection: "column", alignItems: "center", gap: 6,
              }}
            >
              <span style={{ fontSize: 24 }}>{managerApp.idUploaded ? "âœ“" : "ğŸªª"}</span>
              {managerApp.idUploaded ? "ID Uploaded" : "Upload government ID (front & back)"}
            </button>
          </div>

          {/* Proof of Address */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 8, letterSpacing: 0.3 }}>
              PROOF OF ADDRESS (OPTIONAL)
            </label>
            <button
              onClick={() => setManagerApp(p => ({ ...p, proofUploaded: true }))}
              style={{
                width: "100%", padding: "20px 16px", borderRadius: 12, cursor: "pointer", transition: "all 0.2s",
                border: managerApp.proofUploaded ? "2px solid #00B14F" : "2px dashed rgba(255,255,255,0.1)",
                background: managerApp.proofUploaded ? "rgba(0,177,79,0.06)" : "rgba(255,255,255,0.02)",
                color: managerApp.proofUploaded ? "#00D65B" : "rgba(255,255,255,0.3)",
                fontSize: 12, fontWeight: 600, display: "flex", flexDirection: "column", alignItems: "center", gap: 4,
              }}
            >
              <span style={{ fontSize: 20 }}>{managerApp.proofUploaded ? "âœ“" : "ğŸ“„"}</span>
              {managerApp.proofUploaded ? "Proof Uploaded" : "Utility bill or bank statement"}
            </button>
          </div>

          {/* Reason / Motivation */}
          <div style={{ marginBottom: 20 }}>
            <label style={{ display: "block", fontSize: 12, fontWeight: 600, color: "rgba(255,255,255,0.5)", marginBottom: 6, letterSpacing: 0.3 }}>
              WHY DO YOU WANT TO MANAGE A CIRCLE? * <span style={{ color: "rgba(255,255,255,0.2)", fontWeight: 400 }}>(min 20 chars)</span>
            </label>
            <textarea
              value={managerApp.reason}
              onChange={(e) => setManagerApp(p => ({ ...p, reason: e.target.value }))}
              placeholder="Tell us about your experience, your community, and why you want to lead a savings circle..."
              rows={4}
              style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, outline: "none", resize: "vertical", fontFamily: "inherit", lineHeight: 1.5, boxSizing: "border-box" }}
            />
            <div style={{ fontSize: 10, color: managerApp.reason.length >= 20 ? "rgba(255,255,255,0.25)" : "rgba(239,68,68,0.6)", marginTop: 4, textAlign: "right" }}>
              {managerApp.reason.length}/20 min characters
            </div>
          </div>

          {/* Review Summary */}
          <div style={{ background: "rgba(255,255,255,0.03)", borderRadius: 14, padding: "16px 18px", marginBottom: 20 }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.4)", marginBottom: 10, letterSpacing: 0.5 }}>APPLICATION SUMMARY</div>
            {[
              { label: "Circle", value: managerApp.circleName || "â€”" },
              { label: "Monthly", value: managerApp.monthlyContribution ? formatCurrency(managerApp.monthlyContribution, r.symbol) : "â€”" },
              { label: "Members", value: `Up to ${managerApp.maxMembers}` },
              { label: "Location", value: managerApp.location },
              { label: "Min Rating", value: `${managerApp.minRating}â˜…` },
              { label: "Member Entry", value: "Smart Vouch (4.0â˜…+ direct, others need bond)" },
            ].map((row, i) => (
              <div key={i} style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", fontSize: 12 }}>
                <span style={{ color: "rgba(255,255,255,0.4)" }}>{row.label}</span>
                <span style={{ color: "#fff", fontWeight: 600 }}>{row.value}</span>
              </div>
            ))}
            <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "8px 0" }} />
            {[
              { label: "Manager Fee", value: `${currentLevel.feePercent}% (Lv.${currentLevel.level})`, color: currentLevel.color },
              { label: "Platform Fee", value: `${PLATFORM_FEE}%`, color: "#60A5FA" },
              { label: "Total Fee", value: `${(currentLevel.feePercent + PLATFORM_FEE).toFixed(1)}%`, color: "#fff" },
              { label: "Security Deposit", value: managerApp.monthlyContribution ? formatCurrency(computeSecurityDeposit(), r.symbol) : "â€”", color: "#FBBF24" },
              { label: "Bank Account", value: userStats.bankVerified ? `${userStats.bankName} â€¢â€¢${userStats.bankLast4}` : "Not linked", color: userStats.bankVerified ? "#00D65B" : "#EF4444" },
            ].map((row, i) => (
              <div key={i} style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", fontSize: 12 }}>
                <span style={{ color: "rgba(255,255,255,0.4)" }}>{row.label}</span>
                <span style={{ color: row.color || "#fff", fontWeight: 600 }}>{row.value}</span>
              </div>
            ))}
          </div>

          {/* What Happens Next */}
          <div style={{ background: "rgba(59,130,246,0.06)", borderRadius: 12, padding: "14px 16px", border: "1px solid rgba(59,130,246,0.1)", marginBottom: 20 }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: "#60A5FA", marginBottom: 8 }}>WHAT HAPPENS NEXT</div>
            <div style={{ fontSize: 12, color: "rgba(255,255,255,0.5)", lineHeight: 1.6 }}>
              1. Our team reviews your application (2â€“5 business days)
              {"\n"}2. You may be contacted for a brief video call
              {"\n"}3. Security deposit of {managerApp.monthlyContribution ? formatCurrency(computeSecurityDeposit(), r.symbol) : "â€”"} locked from your wallet
              {"\n"}4. Once approved, your circle goes live for members to join
              {"\n"}5. You'll receive manager training materials
            </div>
          </div>

          <button
            onClick={() => canSubmit ? setCreateStep("submitted") : null}
            disabled={!canSubmit}
            style={{
              width: "100%", padding: "16px", borderRadius: 14, border: "none",
              background: canSubmit ? "linear-gradient(135deg, #A855F7, #7C3AED)" : "rgba(255,255,255,0.06)",
              color: canSubmit ? "#fff" : "rgba(255,255,255,0.25)",
              fontSize: 15, fontWeight: 700,
              cursor: canSubmit ? "pointer" : "not-allowed",
              boxShadow: canSubmit ? "0 4px 20px rgba(168,85,247,0.3)" : "none",
            }}
          >
            Submit for Company Review
          </button>
        </div>
      );
    }

    // Step: Submitted Confirmation
    if (createStep === "submitted") {
      return (
        <div style={{ padding: "0 20px 20px" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 12, padding: "16px 0" }}>
            <div style={{ flex: 1 }} />
            <Logo size={24} variant="icon" />
          </div>

          <div style={{ textAlign: "center", padding: "40px 20px" }}>
            <div style={{
              width: 80, height: 80, borderRadius: "50%",
              background: "linear-gradient(135deg, rgba(168,85,247,0.15), rgba(124,58,237,0.15))",
              display: "flex", alignItems: "center", justifyContent: "center",
              margin: "0 auto 24px", fontSize: 36,
              boxShadow: "0 0 40px rgba(168,85,247,0.2)",
            }}>
              ğŸ‰
            </div>
            <div style={{ fontSize: 22, fontWeight: 800, color: "#fff", marginBottom: 8 }}>Application Submitted!</div>
            <div style={{ fontSize: 14, color: "rgba(255,255,255,0.45)", lineHeight: 1.6, marginBottom: 8 }}>
              Your manager application for <strong style={{ color: "#A855F7" }}>{managerApp.circleName}</strong> is now under review.
            </div>
            <div style={{ fontSize: 13, color: "rgba(255,255,255,0.35)", marginBottom: 32 }}>
              Estimated review time: 2â€“5 business days
            </div>

            {/* Status Tracker */}
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "20px", border: "1px solid rgba(255,255,255,0.06)", textAlign: "left", marginBottom: 24 }}>
              {[
                { label: "Application Received", done: true, active: false },
                { label: "Under Company Review", done: false, active: true },
                { label: "Background Verification", done: false, active: false },
                { label: "Approval & Circle Launch", done: false, active: false },
              ].map((step, i) => (
                <div key={i} style={{ display: "flex", gap: 12, padding: "10px 0" }}>
                  <div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
                    <div style={{
                      width: 24, height: 24, borderRadius: "50%", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700,
                      background: step.done ? "#00B14F" : step.active ? "rgba(168,85,247,0.3)" : "rgba(255,255,255,0.06)",
                      color: step.done ? "#fff" : step.active ? "#A855F7" : "rgba(255,255,255,0.2)",
                      border: step.active ? "2px solid #A855F7" : "none",
                      boxShadow: step.active ? "0 0 12px rgba(168,85,247,0.3)" : "none",
                    }}>
                      {step.done ? "âœ“" : i + 1}
                    </div>
                    {i < 3 && <div style={{ width: 2, height: 20, background: step.done ? "#00B14F" : "rgba(255,255,255,0.06)", marginTop: 4 }} />}
                  </div>
                  <div style={{ paddingTop: 2 }}>
                    <div style={{ fontSize: 13, fontWeight: step.active ? 700 : 500, color: step.done ? "#00D65B" : step.active ? "#A855F7" : "rgba(255,255,255,0.3)" }}>
                      {step.label}
                    </div>
                    {step.active && <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>In progress...</div>}
                  </div>
                </div>
              ))}
            </div>

            <button
              onClick={() => { setShowCreateFlow(false); setCreateStep("eligibility"); }}
              style={{ width: "100%", padding: "16px", borderRadius: 14, border: "none", background: "linear-gradient(135deg, #00B14F, #00D65B)", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", boxShadow: "0 4px 20px rgba(0,177,79,0.3)" }}
            >
              Back to Circles
            </button>
          </div>
        </div>
      );
    }
  }

  // â”€â”€â”€ Main Circles View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  return (
    <div style={{ padding: "0 20px 20px" }}>
      {/* Header */}
      <div style={{ padding: "16px 0", display: "flex", justifyContent: "space-between", alignItems: "center" }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <Logo size={24} variant="icon" />
          <div style={{ fontSize: 18, fontWeight: 700, color: "#fff" }}>Circles</div>
        </div>
        <button onClick={() => setShowCreateFlow(true)} style={{ padding: "8px 16px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #A855F7, #7C3AED)", color: "#fff", fontSize: 12, fontWeight: 700, cursor: "pointer", boxShadow: "0 4px 12px rgba(168,85,247,0.25)" }}>
          + Create Circle
        </button>
      </div>

      {/* Your Rating Banner */}
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 16px", background: "rgba(251,191,36,0.06)", borderRadius: 12, border: "1px solid rgba(251,191,36,0.12)", marginBottom: 16 }}>
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <div style={{ width: 32, height: 32, borderRadius: "50%", background: "linear-gradient(135deg, #00B14F, #00D65B)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, color: "#fff" }}>{user.avatar}</div>
          <div>
            <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)", fontWeight: 500 }}>Your Rating</div>
            {renderStars(userRating, 12)}
          </div>
        </div>
        <div style={{ textAlign: "right" }}>
          <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>{userStats.completedCircles} completed</div>
          <div style={{ fontSize: 10, color: "rgba(255,255,255,0.2)" }}>{Math.round((userStats.onTimePayments / (userStats.onTimePayments + userStats.latePayments + userStats.missedPayments)) * 100)}% on-time</div>
        </div>
      </div>

      {/* Tabs */}
      <div style={{ display: "flex", gap: 4, marginBottom: 16, background: "rgba(255,255,255,0.04)", borderRadius: 12, padding: 3 }}>
        {[
          { id: "my", label: "My Circles" },
          { id: "discover", label: "Nearby" },
          { id: "vouch", label: `Vouch${activeBonds.filter(b=>b.status==="active").length > 0 ? ` (${activeBonds.filter(b=>b.status==="active").length})` : ""}` },
        ].map((t) => (
          <button
            key={t.id}
            onClick={() => setTab(t.id)}
            style={{
              flex: 1, padding: "10px 0", borderRadius: 10, border: "none", fontSize: 12, fontWeight: 600, cursor: "pointer",
              background: tab === t.id ? "rgba(0,177,79,0.15)" : "transparent",
              color: tab === t.id ? "#00D65B" : "rgba(255,255,255,0.4)",
              transition: "all 0.2s",
            }}
          >
            {t.label}
          </button>
        ))}
      </div>

      {/* â”€â”€â”€ My Circles Tab â”€â”€â”€ */}
      {tab === "my" && (
        <div>
          {myCircles.map((c) => (
            <div
              key={c.id}
              onClick={() => setActiveCircleView(c)}
              style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 10, cursor: "pointer", transition: "all 0.2s" }}
            >
              <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 14 }}>
                <div style={{ width: 44, height: 44, borderRadius: 12, background: "rgba(0,177,79,0.08)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22 }}>{c.emoji}</div>
                <div style={{ flex: 1 }}>
                  <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>{c.name}</div>
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 2 }}>ğŸ“ {c.location} Â· {c.members} members</div>
                </div>
                <span style={{ padding: "4px 10px", borderRadius: 20, background: c.status === "active" ? "rgba(0,177,79,0.15)" : "rgba(245,158,11,0.15)", color: c.status === "active" ? "#00D65B" : "#F59E0B", fontSize: 10, fontWeight: 700 }}>
                  {c.status === "active" ? "Active" : "Forming"}
                </span>
              </div>

              {/* Manager */}
              <div style={{ display: "flex", alignItems: "center", gap: 8, padding: "8px 10px", background: "rgba(255,255,255,0.03)", borderRadius: 8, marginBottom: 12 }}>
                <div style={{ width: 22, height: 22, borderRadius: "50%", background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, fontWeight: 700, color: "#fff" }}>{c.manager.avatar}</div>
                <span style={{ fontSize: 11, color: "rgba(255,255,255,0.5)" }}>Managed by <strong style={{ color: "rgba(255,255,255,0.7)" }}>{c.manager.name}</strong></span>
                {c.manager.verified && <span style={{ fontSize: 8, padding: "1px 5px", borderRadius: 4, background: "rgba(0,177,79,0.15)", color: "#00D65B", fontWeight: 700 }}>âœ“</span>}
              </div>

              {/* Progress */}
              <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 6, height: 4, marginBottom: 10 }}>
                <div style={{ width: `${(c.currentRound / c.totalRounds) * 100}%`, height: "100%", borderRadius: 6, background: c.status === "active" ? "linear-gradient(90deg, #00B14F, #00D65B)" : "linear-gradient(90deg, #F59E0B, #FBBF24)" }} />
              </div>
              <div style={{ display: "flex", justifyContent: "space-between", fontSize: 11 }}>
                <span style={{ color: "rgba(255,255,255,0.35)" }}>Round {c.currentRound}/{c.totalRounds}</span>
                <span style={{ color: "#fff", fontWeight: 600 }}>{formatCurrency(c.monthlyContribution, r.symbol)}/mo</span>
              </div>
            </div>
          ))}
        </div>
      )}

      {/* â”€â”€â”€ Discover / Nearby Tab â”€â”€â”€ */}
      {tab === "discover" && (
        <div>
          {/* Location Header */}
          <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 14, padding: "10px 14px", background: "rgba(59,130,246,0.06)", borderRadius: 10, border: "1px solid rgba(59,130,246,0.1)" }}>
            <span style={{ fontSize: 16 }}>ğŸ“</span>
            <div>
              <div style={{ fontSize: 12, fontWeight: 600, color: "#60A5FA" }}>Showing circles near Manila, PH</div>
              <div style={{ fontSize: 10, color: "rgba(255,255,255,0.3)" }}>Sorted by distance Â· {discoverCircles.length} circles available</div>
            </div>
          </div>

          {discoverCircles.map((c) => {
            const eligible = meetsRating(c.minRating);
            return (
              <div
                key={c.id}
                onClick={() => setSelectedCircle(c)}
                style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 16, padding: "18px", border: eligible ? "1px solid rgba(255,255,255,0.06)" : "1px solid rgba(255,255,255,0.03)", marginBottom: 10, cursor: "pointer", opacity: eligible ? 1 : 0.6, transition: "all 0.2s" }}
              >
                <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 10 }}>
                  <div style={{ width: 44, height: 44, borderRadius: 12, background: "rgba(0,177,79,0.08)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22 }}>{c.emoji}</div>
                  <div style={{ flex: 1 }}>
                    <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>{c.name}</div>
                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 2 }}>ğŸ“ {c.location} Â· {c.distance}</div>
                  </div>
                </div>

                <div style={{ display: "flex", flexWrap: "wrap", gap: 6, marginBottom: 10 }}>
                  <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(255,255,255,0.06)", color: "rgba(255,255,255,0.5)" }}>
                    {formatCurrency(c.monthlyContribution, r.symbol)}/mo
                  </span>
                  <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(0,177,79,0.1)", color: "#00D65B" }}>
                    {c.spotsLeft} spot{c.spotsLeft !== 1 ? "s" : ""} left
                  </span>
                  <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(251,191,36,0.1)", color: "#FBBF24" }}>
                    Min {c.minRating}â˜…
                  </span>
                  {c.requiresVote && (
                    <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(59,130,246,0.1)", color: "#60A5FA" }}>
                      ğŸ¤ Vouch to join
                    </span>
                  )}
                  {!eligible && (
                    <span style={{ fontSize: 10, padding: "3px 8px", borderRadius: 6, background: "rgba(239,68,68,0.1)", color: "#EF4444" }}>
                      Rating too low
                    </span>
                  )}
                </div>

                {/* Manager Row */}
                <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    <div style={{ width: 20, height: 20, borderRadius: "50%", background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 7, fontWeight: 700, color: "#fff" }}>{c.manager.avatar}</div>
                    <span style={{ fontSize: 10, color: "rgba(255,255,255,0.4)" }}>{c.manager.name}</span>
                    {renderStars(c.manager.rating, 8)}
                  </div>
                  <span style={{ fontSize: 11, color: "#00D65B", fontWeight: 600 }}>View â†’</span>
                </div>
              </div>
            );
          })}
        </div>
      )}

      {/* â”€â”€â”€ Smart Vouch Tab â”€â”€â”€ */}
      {tab === "vouch" && (
        <div>
          {/* Invite Button */}
          <button
            onClick={() => { setShowInvite(true); setInviteStep("search"); setInviteEmail(""); setInviteeData(null); setBondConfirmed(false); }}
            style={{ width: "100%", padding: "14px", borderRadius: 12, border: "none", background: "linear-gradient(135deg, #3B82F6, #1D4ED8)", color: "#fff", fontSize: 13, fontWeight: 700, cursor: "pointer", marginBottom: 16, boxShadow: "0 4px 16px rgba(59,130,246,0.3)", display: "flex", alignItems: "center", justifyContent: "center", gap: 8 }}
          >
            <span style={{ fontSize: 16 }}>ğŸ¤</span> Invite a Friend to a Circle
          </button>

          {/* â”€â”€â”€ Invite Flow â”€â”€â”€ */}
          {showInvite && (
            <div style={{ background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 20, padding: "20px", border: "1px solid rgba(59,130,246,0.15)", marginBottom: 16 }}>
              
              {/* Step: Search */}
              {inviteStep === "search" && (
                <div>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
                    <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>Invite to Circle</div>
                    <button onClick={() => setShowInvite(false)} style={{ background: "none", border: "none", color: "rgba(255,255,255,0.3)", cursor: "pointer", fontSize: 18 }}>âœ•</button>
                  </div>
                  
                  <div style={{ fontSize: 11, fontWeight: 600, color: "rgba(255,255,255,0.4)", marginBottom: 6, letterSpacing: 0.3 }}>SELECT CIRCLE</div>
                  <div style={{ display: "flex", gap: 6, marginBottom: 16 }}>
                    {myCircles.filter(c => c.members < (c.maxMembers || 10)).map((c) => (
                      <button key={c.id} onClick={() => setInviteCircle(c)} style={{
                        flex: 1, padding: "10px 8px", borderRadius: 10, cursor: "pointer", textAlign: "center",
                        border: inviteCircle?.id === c.id ? "1px solid #3B82F6" : "1px solid rgba(255,255,255,0.06)",
                        background: inviteCircle?.id === c.id ? "rgba(59,130,246,0.1)" : "rgba(255,255,255,0.03)",
                        color: inviteCircle?.id === c.id ? "#60A5FA" : "rgba(255,255,255,0.5)", fontSize: 11, fontWeight: 600,
                      }}>
                        <div style={{ fontSize: 16, marginBottom: 2 }}>{c.emoji}</div>
                        {c.name}
                      </button>
                    ))}
                  </div>

                  <div style={{ fontSize: 11, fontWeight: 600, color: "rgba(255,255,255,0.4)", marginBottom: 6, letterSpacing: 0.3 }}>FRIEND'S EMAIL</div>
                  <input
                    value={inviteEmail}
                    onChange={(e) => setInviteEmail(e.target.value)}
                    placeholder="e.g. juan@email.com"
                    style={{ width: "100%", padding: "14px 16px", borderRadius: 12, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, outline: "none", marginBottom: 6, boxSizing: "border-box" }}
                  />
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.2)", marginBottom: 16 }}>Try: juan@email.com (new) Â· ana@email.com (low rating) Â· rick@email.com (trusted)</div>

                  <button
                    onClick={() => { if (inviteEmail && inviteCircle) { setInviteeData(lookupInvitee(inviteEmail)); setInviteStep("risk"); } }}
                    disabled={!inviteEmail || !inviteCircle}
                    style={{
                      width: "100%", padding: "14px", borderRadius: 12, border: "none",
                      background: inviteEmail && inviteCircle ? "linear-gradient(135deg, #3B82F6, #1D4ED8)" : "rgba(255,255,255,0.06)",
                      color: inviteEmail && inviteCircle ? "#fff" : "rgba(255,255,255,0.2)", fontSize: 14, fontWeight: 700,
                      cursor: inviteEmail && inviteCircle ? "pointer" : "not-allowed",
                    }}
                  >
                    Check & Invite
                  </button>
                </div>
              )}

              {/* Step: Risk Assessment */}
              {inviteStep === "risk" && inviteeData && (
                <div>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 16 }}>
                    <button onClick={() => setInviteStep("search")} style={{ background: "none", border: "none", color: "#fff", fontSize: 18, cursor: "pointer" }}>â†</button>
                    <div style={{ fontSize: 15, fontWeight: 700, color: "#fff" }}>Smart Vouch</div>
                    <div style={{ width: 24 }} />
                  </div>

                  {/* Invitee Profile */}
                  <div style={{ textAlign: "center", marginBottom: 16 }}>
                    <div style={{ width: 56, height: 56, borderRadius: "50%", background: inviteeData.bondRequired ? "linear-gradient(135deg, #F59E0B, #D97706)" : "linear-gradient(135deg, #00B14F, #00D65B)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18, fontWeight: 700, color: "#fff", margin: "0 auto 10px" }}>{inviteeData.avatar}</div>
                    <div style={{ fontSize: 16, fontWeight: 700, color: "#fff" }}>{inviteeData.name}</div>
                    <div style={{ fontSize: 12, color: "rgba(255,255,255,0.4)", marginTop: 4 }}>
                      {inviteeData.isNew ? "ğŸ†• New User â€” No History" : `${inviteeData.completedCircles} circles Â· ${inviteeData.rating}â˜…`}
                    </div>
                    {inviteeData.rating && (
                      <div style={{ display: "flex", justifyContent: "center", marginTop: 6 }}>{renderStars(inviteeData.rating, 14)}</div>
                    )}
                  </div>

                  {/* Risk Card */}
                  <div style={{
                    padding: "16px", borderRadius: 14, marginBottom: 16,
                    background: inviteeData.bondRequired ? "rgba(245,158,11,0.08)" : "rgba(0,177,79,0.06)",
                    border: inviteeData.bondRequired ? "1px solid rgba(245,158,11,0.2)" : "1px solid rgba(0,177,79,0.15)",
                  }}>
                    <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }}>
                      <span style={{ fontSize: 20 }}>{inviteeData.bondRequired ? "âš ï¸" : "âœ…"}</span>
                      <div>
                        <div style={{ fontSize: 14, fontWeight: 700, color: inviteeData.bondRequired ? "#FBBF24" : "#00D65B" }}>
                          {inviteeData.bondRequired ? "Trust Bond Required" : "No Bond Needed â€” Trusted Member"}
                        </div>
                        <div style={{ fontSize: 11, color: "rgba(255,255,255,0.4)" }}>
                          {inviteeData.isNew ? "New account â€” no payment history" : inviteeData.rating < 4.0 ? `Rating ${inviteeData.rating}â˜… below 4.0â˜… threshold` : `Rating ${inviteeData.rating}â˜… â€” verified trustworthy`}
                        </div>
                      </div>
                    </div>

                    {inviteeData.bondRequired && (
                      <div>
                        <div style={{ height: 1, background: "rgba(255,255,255,0.06)", margin: "10px 0" }} />
                        {[
                          { label: "Circle Contribution", value: formatCurrency(inviteCircle?.monthlyContribution || 1000, r.symbol) },
                          { label: "Required Bond (50%)", value: formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol), color: "#FBBF24", bold: true },
                          { label: "Lock Period", value: "5 months" },
                        ].map((row, i) => (
                          <div key={i} style={{ display: "flex", justifyContent: "space-between", padding: "6px 0", fontSize: 12 }}>
                            <span style={{ color: "rgba(255,255,255,0.45)" }}>{row.label}</span>
                            <span style={{ color: row.color || "#fff", fontWeight: row.bold ? 800 : 600 }}>{row.value}</span>
                          </div>
                        ))}
                        <div style={{ marginTop: 12, padding: "12px", background: "rgba(0,0,0,0.2)", borderRadius: 10, fontSize: 11, color: "rgba(255,255,255,0.5)", lineHeight: 1.6 }}>
                          <strong style={{ color: "#FBBF24" }}>This money is YOURS.</strong> It is just locked. If {inviteeData.name.split(" ")[0]} pays on time for 5 months, this {formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol)} will be <strong style={{ color: "#00D65B" }}>automatically applied to YOUR 6th month contribution</strong>.
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Happy Path vs Default */}
                  <div style={{ padding: "14px", background: "rgba(255,255,255,0.03)", borderRadius: 12, marginBottom: 16 }}>
                    <div style={{ fontSize: 10, fontWeight: 700, color: "#00D65B", marginBottom: 6, letterSpacing: 0.5 }}>âœ“ IF {inviteeData.name.split(" ")[0].toUpperCase()} PAYS ON TIME</div>
                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.45)", lineHeight: 1.5, marginBottom: 12 }}>
                      5 successful payments â†’ Bond unlocked â†’ Applied to your next contribution. You save {formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol)} that month!
                    </div>
                    <div style={{ fontSize: 10, fontWeight: 700, color: "#EF4444", marginBottom: 6, letterSpacing: 0.5 }}>âš  IF {inviteeData.name.split(" ")[0].toUpperCase()} DEFAULTS</div>
                    <div style={{ fontSize: 11, color: "rgba(255,255,255,0.45)", lineHeight: 1.5 }}>
                      Missed payment by 48hrs â†’ Manager marks default â†’ Bond seized to cover the circle's loss. You will be notified immediately.
                    </div>
                  </div>

                  {/* Manager's View Preview */}
                  {inviteeData.bondRequired && (
                    <div style={{ padding: "12px 14px", background: "rgba(168,85,247,0.06)", borderRadius: 10, border: "1px solid rgba(168,85,247,0.1)", marginBottom: 16 }}>
                      <div style={{ fontSize: 10, fontWeight: 700, color: "#A855F7", marginBottom: 6, letterSpacing: 0.5 }}>MANAGER WILL SEE</div>
                      <div style={{ fontSize: 11, color: "rgba(255,255,255,0.5)", lineHeight: 1.5 }}>
                        "Vouched by {user.name} Â· âœ… {formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol)} Bond Locked â€” If {inviteeData.name.split(" ")[0]} runs away, {user.name.split(" ")[0]} pays."
                      </div>
                    </div>
                  )}

                  <button
                    onClick={() => { setBondConfirmed(true); setInviteStep("sent"); }}
                    style={{
                      width: "100%", padding: "16px", borderRadius: 14, border: "none",
                      background: inviteeData.bondRequired ? "linear-gradient(135deg, #F59E0B, #D97706)" : "linear-gradient(135deg, #00B14F, #00D65B)",
                      color: "#fff", fontSize: 14, fontWeight: 700, cursor: "pointer",
                      boxShadow: inviteeData.bondRequired ? "0 4px 20px rgba(245,158,11,0.3)" : "0 4px 20px rgba(0,177,79,0.3)",
                    }}
                  >
                    {inviteeData.bondRequired ? `ğŸ”’ Stake ${formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol)} & Send Invite` : "ğŸ¤ Send Invite (No Bond Needed)"}
                  </button>
                </div>
              )}

              {/* Step: Sent */}
              {inviteStep === "sent" && (
                <div style={{ textAlign: "center", padding: "20px 0" }}>
                  <div style={{ width: 64, height: 64, borderRadius: "50%", background: "rgba(0,177,79,0.1)", display: "flex", alignItems: "center", justifyContent: "center", margin: "0 auto 16px", fontSize: 28, boxShadow: "0 0 30px rgba(0,177,79,0.15)" }}>ğŸ¤</div>
                  <div style={{ fontSize: 18, fontWeight: 800, color: "#fff", marginBottom: 6 }}>Invite Sent!</div>
                  <div style={{ fontSize: 13, color: "rgba(255,255,255,0.45)", marginBottom: 4 }}>{inviteeData?.name} invited to {inviteCircle?.name}</div>
                  {inviteeData?.bondRequired && (
                    <div style={{ fontSize: 12, color: "#FBBF24", fontWeight: 600, marginBottom: 4 }}>
                      ğŸ”’ {formatCurrency((inviteCircle?.monthlyContribution || 1000) * 0.5, r.symbol)} bond locked for 5 months
                    </div>
                  )}
                  <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>The circle manager will review the application</div>
                  <button onClick={() => setShowInvite(false)} style={{ marginTop: 20, padding: "12px 32px", borderRadius: 10, border: "none", background: "rgba(255,255,255,0.06)", color: "#fff", fontSize: 13, fontWeight: 600, cursor: "pointer" }}>Done</button>
                </div>
              )}
            </div>
          )}

          {/* â”€â”€â”€ Two-Sided Bond Ledger â”€â”€â”€ */}
          
          {/* SECTION 1: Bonds You Gave (as Voucher) */}
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              <span style={{ fontSize: 14 }}>ğŸ“¤</span>
              <span style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>You Vouched For</span>
            </div>
            <div style={{ textAlign: "right" }}>
              <span style={{ fontSize: 11, color: "#FBBF24", fontWeight: 700 }}>
                {formatCurrency(bondsAsVoucher.filter(b => b.status === "active").reduce((s, b) => s + b.amount, 0), r.symbol)} locked
              </span>
            </div>
          </div>
          
          {bondsAsVoucher.length === 0 ? (
            <div style={{ padding: "20px", background: "rgba(255,255,255,0.03)", borderRadius: 12, textAlign: "center", marginBottom: 16 }}>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>You haven't vouched for anyone yet</div>
            </div>
          ) : (
            bondsAsVoucher.map((bond) => {
              const progress = (bond.monthsCompleted / bond.monthsRequired) * 100;
              const isReleased = bond.status === "released";
              const isSeized = bond.status === "seized";
              return (
                <div key={bond.id} style={{
                  background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 14, padding: "16px", marginBottom: 8,
                  border: isReleased ? "1px solid rgba(0,177,79,0.15)" : isSeized ? "1px solid rgba(239,68,68,0.15)" : "1px solid rgba(245,158,11,0.12)",
                }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 10 }}>
                    <div style={{ width: 38, height: 38, borderRadius: "50%", background: isReleased ? "rgba(0,177,79,0.1)" : "rgba(245,158,11,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 700, color: "#fff" }}>{bond.avatar}</div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>You â†’ {bond.guaranteedUser}</div>
                      <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>{bond.circle}</div>
                    </div>
                    <div style={{ textAlign: "right" }}>
                      <div style={{ fontSize: 14, fontWeight: 800, color: isReleased ? "#00D65B" : "#FBBF24" }}>{formatCurrency(bond.amount, r.symbol)}</div>
                      <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 6, fontWeight: 700, background: isReleased ? "rgba(0,177,79,0.15)" : isSeized ? "rgba(239,68,68,0.15)" : "rgba(245,158,11,0.12)", color: isReleased ? "#00D65B" : isSeized ? "#EF4444" : "#FBBF24" }}>
                        {isReleased ? "RELEASED âœ“" : isSeized ? "SEIZED" : "LOCKED"}
                      </span>
                    </div>
                  </div>
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 10, color: "rgba(255,255,255,0.3)", marginBottom: 4 }}>
                    <span>{bond.monthsCompleted}/{bond.monthsRequired} months</span>
                    <span>{isReleased ? "Applied to your contribution!" : `${bond.monthsRequired - bond.monthsCompleted} left`}</span>
                  </div>
                  <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 4, height: 5 }}>
                    <div style={{ width: `${progress}%`, height: "100%", borderRadius: 4, background: isReleased ? "linear-gradient(90deg, #00B14F, #00D65B)" : "linear-gradient(90deg, #F59E0B, #FBBF24)" }} />
                  </div>
                  {isReleased && (
                    <div style={{ marginTop: 8, padding: "8px 10px", background: "rgba(0,177,79,0.06)", borderRadius: 8, fontSize: 10, color: "#00D65B", fontWeight: 600, textAlign: "center" }}>
                      ğŸ‰ Bond applied to your contribution â€” saved {formatCurrency(bond.amount, r.symbol)}!
                    </div>
                  )}
                </div>
              );
            })
          )}

          {/* SECTION 2: Bonds Others Gave for You (as Vouchee) */}
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 16, marginBottom: 10 }}>
            <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
              <span style={{ fontSize: 14 }}>ğŸ“¥</span>
              <span style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>Vouched For You</span>
            </div>
            <div style={{ textAlign: "right" }}>
              <span style={{ fontSize: 11, color: "#60A5FA", fontWeight: 700 }}>
                {formatCurrency(bondsAsVouchee.reduce((s, b) => s + b.amount, 0), r.symbol)} total trust
              </span>
            </div>
          </div>

          {bondsAsVouchee.length === 0 ? (
            <div style={{ padding: "20px", background: "rgba(255,255,255,0.03)", borderRadius: 12, textAlign: "center", marginBottom: 16 }}>
              <div style={{ fontSize: 11, color: "rgba(255,255,255,0.3)" }}>No one has vouched for you yet</div>
            </div>
          ) : (
            bondsAsVouchee.map((bond) => {
              const progress = (bond.monthsCompleted / bond.monthsRequired) * 100;
              const isReleased = bond.status === "released";
              return (
                <div key={bond.id} style={{
                  background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 14, padding: "16px", marginBottom: 8,
                  border: isReleased ? "1px solid rgba(59,130,246,0.1)" : "1px solid rgba(59,130,246,0.08)",
                }}>
                  <div style={{ display: "flex", alignItems: "center", gap: 12, marginBottom: 10 }}>
                    <div style={{ width: 38, height: 38, borderRadius: "50%", background: "rgba(59,130,246,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 12, fontWeight: 700, color: "#fff" }}>{bond.avatar}</div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>{bond.voucher} â†’ You</div>
                      <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>{bond.circle}</div>
                    </div>
                    <div style={{ textAlign: "right" }}>
                      <div style={{ fontSize: 14, fontWeight: 800, color: "#60A5FA" }}>{formatCurrency(bond.amount, r.symbol)}</div>
                      <span style={{ fontSize: 9, padding: "2px 6px", borderRadius: 6, fontWeight: 700, background: isReleased ? "rgba(0,177,79,0.15)" : "rgba(59,130,246,0.1)", color: isReleased ? "#00D65B" : "#60A5FA" }}>
                        {isReleased ? "TRUST EARNED âœ“" : `${bond.monthsCompleted}/${bond.monthsRequired} months`}
                      </span>
                    </div>
                  </div>
                  <div style={{ display: "flex", justifyContent: "space-between", fontSize: 10, color: "rgba(255,255,255,0.3)", marginBottom: 4 }}>
                    <span>{bond.monthsCompleted}/{bond.monthsRequired} months</span>
                    <span>{isReleased ? "Bond returned to voucher" : `Pay on time to release their bond`}</span>
                  </div>
                  <div style={{ background: "rgba(255,255,255,0.06)", borderRadius: 4, height: 5 }}>
                    <div style={{ width: `${progress}%`, height: "100%", borderRadius: 4, background: "linear-gradient(90deg, #3B82F6, #60A5FA)" }} />
                  </div>
                  {isReleased && (
                    <div style={{ marginTop: 8, padding: "8px 10px", background: "rgba(59,130,246,0.06)", borderRadius: 8, fontSize: 10, color: "#60A5FA", fontWeight: 600, textAlign: "center" }}>
                      âœ“ You proved trustworthy â€” {bond.voucher}'s bond was returned
                    </div>
                  )}
                </div>
              );
            })
          )}

          {/* Trust Summary */}
          <div style={{ marginTop: 12, padding: "14px 16px", background: "linear-gradient(145deg, #111827, #1A2332)", borderRadius: 14, border: "1px solid rgba(255,255,255,0.06)" }}>
            <div style={{ fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.35)", marginBottom: 10, letterSpacing: 0.5 }}>YOUR TRUST NETWORK</div>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8 }}>
              <div style={{ textAlign: "center", padding: "10px", background: "rgba(255,255,255,0.03)", borderRadius: 8 }}>
                <div style={{ fontSize: 16, fontWeight: 800, color: "#FBBF24" }}>{formatCurrency(bondsAsVoucher.reduce((s, b) => s + b.amount, 0), r.symbol)}</div>
                <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>You Staked</div>
              </div>
              <div style={{ textAlign: "center", padding: "10px", background: "rgba(255,255,255,0.03)", borderRadius: 8 }}>
                <div style={{ fontSize: 16, fontWeight: 800, color: "#60A5FA" }}>{formatCurrency(bondsAsVouchee.reduce((s, b) => s + b.amount, 0), r.symbol)}</div>
                <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>Staked for You</div>
              </div>
              <div style={{ textAlign: "center", padding: "10px", background: "rgba(255,255,255,0.03)", borderRadius: 8 }}>
                <div style={{ fontSize: 16, fontWeight: 800, color: "#00D65B" }}>{bondsAsVoucher.length + bondsAsVouchee.length}</div>
                <div style={{ fontSize: 9, color: "rgba(255,255,255,0.3)", marginTop: 2 }}>Total Bonds</div>
              </div>
            </div>
          </div>

          {/* How It Works */}
          <div style={{ marginTop: 12, padding: "16px", background: "rgba(59,130,246,0.06)", borderRadius: 14, border: "1px solid rgba(59,130,246,0.1)" }}>
            <div style={{ fontSize: 11, fontWeight: 700, color: "#60A5FA", marginBottom: 10 }}>HOW SMART VOUCH WORKS</div>
            {[
              { icon: "ğŸ”", title: "Auto Risk Check", desc: "System checks invitee's rating & history" },
              { icon: "ğŸ”’", title: "Bond if Risky", desc: "New users or <4.0â˜… â†’ 50% bond from inviter" },
              { icon: "ğŸ’š", title: "Happy Path", desc: "5 on-time payments â†’ bond becomes YOUR free contribution" },
              { icon: "ğŸš¨", title: "Default (48hrs)", desc: "Missed payment â†’ bond covers the circle's loss" },
            ].map((item, i) => (
              <div key={i} style={{ display: "flex", gap: 10, padding: "6px 0" }}>
                <span style={{ fontSize: 14 }}>{item.icon}</span>
                <div>
                  <div style={{ fontSize: 11, fontWeight: 700, color: "rgba(255,255,255,0.6)" }}>{item.title}</div>
                  <div style={{ fontSize: 10, color: "rgba(255,255,255,0.35)" }}>{item.desc}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ Main App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ROSCAApp() {
  const [screen, setScreen] = useState("home");
  const [region, setRegion] = useState("PH");
  const [user, setUser] = useState(MOCK_USER);
  const [toast, setToast] = useState(null);
  const [transactions, setTransactions] = useState([]);

  const handleDeposit = (tx) => {
    setTransactions((prev) => [tx, ...prev]);
    setToast({ message: `Deposit of ${REGIONS[region].symbol}${Number(tx.amount).toLocaleString()} submitted`, type: "success" });
    setScreen("home");
  };

  const showToast = (message, type = "success") => setToast({ message, type });

  return (
    <div
      style={{
        maxWidth: 420,
        margin: "0 auto",
        minHeight: "100vh",
        background: "#0A0E17",
        color: "#fff",
        fontFamily: "'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
        display: "flex",
        flexDirection: "column",
        position: "relative",
        overflow: "hidden",
      }}
    >
      {/* Global Styles */}
      <style>{`
        @keyframes slideDown {
          from { opacity: 0; transform: translate(-50%, -20px); }
          to { opacity: 1; transform: translate(-50%, 0); }
        }
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        @keyframes pulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.4; }
        }
        input::placeholder { color: rgba(255,255,255,0.2); }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        * { box-sizing: border-box; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
      `}</style>

      {/* Status Bar Mock */}
      <div
        style={{
          display: "flex",
          justifyContent: "space-between",
          alignItems: "center",
          padding: "12px 20px 4px",
          fontSize: 12,
          fontWeight: 600,
          color: "#fff",
        }}
      >
        <span>9:41</span>
        <div style={{ display: "flex", gap: 6, alignItems: "center" }}>
          <span style={{ fontSize: 10 }}>5G</span>
          <span>ğŸ“¶</span>
          <span>ğŸ”‹</span>
        </div>
      </div>

      {/* Toast */}
      {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}

      {/* Screen Content */}
      <div style={{ flex: 1, overflowY: "auto", paddingBottom: 20 }}>
        {screen === "home" && <HomeScreen user={user} region={region} onNavigate={setScreen} />}
        {screen === "deposit" && (
          <DepositScreen
            region={region}
            onSubmit={handleDeposit}
            onBack={() => setScreen("home")}
          />
        )}
        {screen === "bid" && <BidScreen region={region} />}
        {screen === "circles" && <CirclesScreen region={region} user={user} />}
        {screen === "settings" && (
          <SettingsScreen
            user={user}
            region={region}
            onRegionChange={(r) => {
              setRegion(r);
              showToast(`Region changed to ${REGIONS[r].name}`);
            }}
          />
        )}
      </div>

      {/* Bottom Nav */}
      <BottomNav active={screen} onNavigate={setScreen} />
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<ROSCAApp />);
</script>
</body>
</html>
